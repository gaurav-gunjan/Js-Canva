!function(e){"use strict";e.fn.palleon=function(t){var a=e(this),n=document.body.clientWidth,i=e.extend({baseURL:"./",PexelsApiKey:"",PexelsPagination:20,PexelsLanguage:"en-US",PexelsImgSize:"large2x",PixabayApiKey:"",PixabayPagination:16,PixabayLanguage:"en",PixabaySafeSearch:"false",PixabayEditorsChice:"false",apiCaching:!0,fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",fontSize:60,fontWeight:"normal",fontStyle:"normal",canvasColor:"transparent",fill:"#000",stroke:"#fff",strokeWidth:0,textBackgroundColor:"rgba(255,255,255,0)",textAlign:"left",lineHeight:1.2,borderColor:"#000",borderDashArray:[4,4],borderOpacityWhenMoving:.5,borderScaleFactor:2,editingBorderColor:"rgba(0,0,0,0.5)",cornerSize:12,cornerStrokeColor:"#000",cornerStyle:"circle",transparentCorners:!1,cursorColor:"#000",cursorWidth:2,enableGLFiltering:!0,textureSize:4096,watermark:!1,watermarkText:"palleon.website",watermarkFontFamily:"Georgia, serif",watermarkFontStyle:"normal",watermarkFontColor:"#000",watermarkFontSize:40,watermarkFontWeight:"bold",watermarkBackgroundColor:"#FFF",watermarkLocation:"bottom-right",templatePreview:!0,customFunctions:function(){}},t),l="",o=new Localbase("palleon"),r="none",s="",d="",c="",p="",f=0,g=1,h=1,m="left",u="top",v="",b=[],y="",$="",w="",k="",_=0,x="add-to-canvas",C=["circle","square","rectangle","triangle","ellipse","trapezoid","octagon","pentagon","emerald","star","diamond","parallelogram","customShape"],j=["square","rectangle","triangle"],A=[["Helvetica Neue","'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"],["Impact","Impact, Charcoal, sans-serif"],["Georgia","Georgia, serif"],["Palatino Linotype","'Palatino Linotype', 'Book Antiqua', Palatino, serif"],["Times New Roman","'Times New Roman', Times, serif"],["Arial","Arial, Helvetica, sans-serif"],["Arial Black","'Arial Black', Gadget, sans-serif"],["Comic Sans","'Comic Sans MS', cursive, sans-serif"],["Lucida Sans","'Lucida Sans Unicode', 'Lucida Grande', sans-serif"],["Tahoma","Tahoma, Geneva, sans-serif"],["Trebuchet","'Trebuchet MS', Helvetica, sans-serif"],["Verdana","Verdana, Geneva, sans-serif"],["Courier New","'Courier New', Courier, monospace"],["Lucida Console","'Lucida Console', Monaco, monospace"]];function I(){o.collection("assets").get().then(e=>{if(void 0===e)I();else if(e.length>0){var t=0,n=0,i=0,l=[];e.forEach(function(e){l.push({src:e.src,key:e.key,type:e.type,name:e.name})}),a.find("#palleon-library-my").html(""),a.find("#palleon-svg-library-my").html(""),a.find("#palleon-my-templates").html(""),l.slice().reverse().forEach(function(e){if("svg"==e.type){let l=new Blob([e.src],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(l);a.find("#palleon-svg-library-my").append('<div class="palleon-masonry-item" data-keyword="'+e.name+'"> <div class="palleon-library-delete" data-target="'+e.key+'"><span class="material-icons">remove</span></div> <div class="palleon-masonry-item-inner"> <div class="palleon-img-wrap"> <img src="'+o+'" data-full="'+o+'" data-filename="'+e.name+'" title="'+e.name+'" data-format="'+e.type+'" /> </div> <div class="palleon-masonry-item-desc">'+e.name+"</div> </div> </div>"),t++}else if("json"==e.type){let r=new Blob([e.src],{type:"text/plain"}),s=URL.createObjectURL(r);a.find("#palleon-my-templates").append('<li data-keyword="'+e.name+'"> <div>'+e.name+'</div> <div> <button type="button" class="palleon-btn primary palleon-select-template" data-json="'+s+'"><span class="material-icons">check</span>'+palleonParams.select+'</button> <button type="button" class="palleon-btn danger palleon-template-delete" data-target="'+e.key+'"><span class="material-icons">clear</span>'+palleonParams.delete+"</button> </div> </li>"),i++}else{let d=R(e.src),c=URL.createObjectURL(d);a.find("#palleon-library-my").append('<div class="palleon-masonry-item" data-keyword="'+e.name+'"> <div class="palleon-library-delete" data-target="'+e.key+'"><span class="material-icons">remove</span></div> <div class="palleon-masonry-item-inner"> <div class="palleon-img-wrap"> <img src="'+c+'" data-full="'+c+'" data-filename="'+e.name+'" title="'+e.name+'" data-format="'+e.type+'" /> </div> <div class="palleon-masonry-item-desc">'+e.name+"</div> </div> </div>"),n++}}),a.find("#palleon-svg-library-my-pagination").remove(),0!==t?S(a.find("#palleon-svg-library-my")):a.find("#palleon-svg-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),a.find("#palleon-library-my-pagination").remove(),0!==n?S(a.find("#palleon-library-my")):a.find("#palleon-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),a.find("#palleon-my-templates-pagination").remove(),0!==i?S(a.find("#palleon-my-templates")):a.find("#palleon-my-templates").html('<div class="notice notice-info">'+palleonParams.easyAccessTemplate+"</div>")}else a.find("#palleon-svg-library-my-pagination").remove(),a.find("#palleon-library-my-pagination").remove(),a.find("#palleon-svg-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),a.find("#palleon-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),a.find("#palleon-my-templates").html('<div class="notice notice-info">'+palleonParams.easyAccessTemplate+"</div>")})}o.config.debug=!1,I(),a.on("click",".palleon-library-delete",function(){var t=e(this).parent().parent(),n=e(this).parent(),i=e(this).attr("data-target");o.collection("assets").doc({key:i}).get().then(e=>{o.collection("assets").doc({key:i}).delete(),n.remove(),a.find("#"+t.attr("id")+"-pagination").remove(),S(t)})}),a.find(".palleon-template-list").on("click",".palleon-template-delete",function(){var t=e(this).parent().parent(),n=e(this).attr("data-target");o.collection("assets").doc({key:n}).get().then(e=>{o.collection("assets").doc({key:n}).delete(),t.remove(),a.find("#palleon-my-templates-pagination").remove(),S(a.find("#palleon-my-templates"))})}),a.find(".crop-custom").css("display","none"),new FontFaceObserver("Material Icons").load(null,1e4).then(function(){e("#palleon").find("#palleon-main-loader").fadeOut(200)}).catch(function(t){console.log(t),e("#palleon").find("#palleon-main-loader").hide()});for(var T=new LazyLoad({callback_error(t){t.setAttribute("src",i.baseURL+"assets/placeholder.png"),e(t).parent().css("min-height","auto"),e(t).parent().find(".palleon-img-loader").remove()},callback_loaded(t){e(t).parent().css("min-height","auto"),e(t).parent().find(".palleon-img-loader").remove()}}),O=0;O<A.length;O++)a.find("#websafe-fonts").append(e('<option class="websafe-font"></option>').attr("value",A[O][1]).text(A[O][0]).attr("data-font",A[O][1]).text(A[O][0]));function S(e){var t=e.find(">*"),n=t.length,i=parseInt(e.data("perpage"));if(n>i){t.slice(i).hide();var l='<div id="'+e.attr("id")+'-pagination" class="palleon-pagination"></div>';e.after(l),a.find("#"+e.attr("id")+"-pagination").pagination({items:n,itemsOnPage:i,prevText:'<span class="material-icons">navigate_before</span>',nextText:'<span class="material-icons">navigate_next</span>',displayedPages:3,onPageClick:function(e,a){void 0!==a&&a.preventDefault();var n=i*(e-1);t.hide().slice(n,n+i).show()}}),a.find("#"+e.attr("id")+"-pagination").pagination("selectPage",1)}}function R(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],n=atob(t[1]),i=n.length,l=new Uint8Array(i);i--;)l[i]=n.charCodeAt(i);return new Blob([l],{type:a})}function F(e,t){var a=new XMLHttpRequest;a.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(a.response)},a.open("GET",e),a.responseType="blob",a.send()}function q(){a.removeClass("panel-closed"),a.find(".palleon-icon-menu-btn").removeClass("active"),a.find("#palleon-icon-menu").removeClass("closed"),a.find("#palleon-toggle-left").removeClass("closed"),a.find("#palleon-toggle-left").find(".material-icons").html("chevron_left"),a.find("#palleon-icon-panel").show()}function P(){a.addClass("panel-closed"),a.find(".palleon-icon-menu-btn").removeClass("active"),a.find("#palleon-icon-menu").addClass("closed"),a.find("#palleon-toggle-left").addClass("closed"),a.find("#palleon-toggle-left").find(".material-icons").html("chevron_right"),a.find("#palleon-icon-panel").hide()}e.getJSON(i.baseURL+"json/google-fonts.json",function(t){for(var n=0;n<t.items.length;n++)a.find("#google-fonts").append(e('<option class="google-font"></option>').attr("value",t.items[n].family).text(t.items[n].family).attr("data-font",t.items[n].family).text(t.items[n].family))}),e.getJSON(i.baseURL+"json/material-icons.json",function(e){for(var t=0;t<e.categories.length;t++)for(var n=e.categories[t],l=0;l<n.icons.length;l++){var o=i.baseURL+"files/icons/"+n.icons[l].group_id+"/"+n.icons[l].ligature;a.find("#palleon-icons .palleon-grid").append('<div class="palleon-element add-element" data-elsource="'+o+'" data-loader="no" title="'+n.icons[l].name+'"><span class="material-icons">'+n.icons[l].ligature+"</div>")}}),a.find(".palleon-select.palleon-select2").select2({theme:"dark",width:"100%",templateSelection:eb,templateResult:eb,allowHtml:!0}),a.find(".palleon-colorpicker.disallow-empty").spectrum({allowEmpty:!1,showInitial:!0,hideAfterPaletteSelect:!0}),a.find(".palleon-colorpicker.allow-empty").spectrum({allowEmpty:!0,showInitial:!1,hideAfterPaletteSelect:!0}),toastr.options.closeButton=!0,toastr.options.positionClass="toast-bottom-right",toastr.options.progressBar=!0,toastr.options.newestOnTop=!1,toastr.options.showEasing="swing",toastr.options.hideEasing="linear",toastr.options.closeEasing="linear",a.find("#palleon-canvas-wrap").draggable({disabled:!0}),a.find(".paginated").each(function(){S(e(this))}),a.find("#palleon-toggle-left").on("click",function(){e(this).hasClass("closed")?q():P()}),a.find("#palleon-toggle-right").on("click",function(){e(this).hasClass("closed")?(a.removeClass("layers-closed"),e(this).removeClass("closed"),e(this).find(".material-icons").html("chevron_right"),a.find("#palleon-right-col").show()):(a.addClass("layers-closed"),e(this).addClass("closed"),e(this).find(".material-icons").html("chevron_left"),a.find("#palleon-right-col").hide())}),a.find(".palleon-toggle-right").on("click",function(e){e.preventDefault(),a.find("#palleon-toggle-right").trigger("click")}),n<=1200&&(a.find("#palleon-toggle-right").trigger("click"),a.find("#palleon-toggle-left").trigger("click")),a.find(".palleon-icon-menu-btn").on("click",function(){e(this).data("target")&&(e(this).hasClass("active")?P():(q(),e(this).addClass("active"),a.find(".palleon-icon-panel-content").addClass("panel-hide"),a.find(e(this).data("target")).removeClass("panel-hide"))),"palleon-btn-elements"==e(this).attr("id")&&a.find("#palleon-all-elements-open").trigger("click")}),a.find(".palleon-dropdown-wrap").on("click",function(){e(this).hasClass("opened")?(e(this).removeClass("opened"),e(this).find(".palleon-dropdown").hide()):(e(this).addClass("opened"),e(this).find(".palleon-dropdown").show())}),a.find(".palleon-icon-panel-content ul.palleon-accordion > li > a").on("click",function(t){t.preventDefault();var a=e(this).parent().parent();e(this).parent().hasClass("opened")?a.find("li").removeClass("opened"):(a.find("li").removeClass("opened"),e(this).parent().addClass("opened"))}),a.find(".palleon-lock-unlock").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),e(this).find(".material-icons").html("lock_open")):(e(this).addClass("active"),e(this).find(".material-icons").html("lock"))}),a.find(".palleon-slider").on("input",function(){e(this).parent().parent().find(".slider-label span").html(e(this).val()),a.find("span.tm-count-zoom").html(e(this).val())}),a.find('input[type="checkbox"]').on("change",function(){e(this).data("conditional")&&(e(this).is(":checked")?a.find(e(this).data("conditional")).removeClass("d-none"):a.find(e(this).data("conditional")).addClass("d-none"))}),a.find(".palleon-tabs-menu li").on("click",function(){var t=e(this).data("target"),a=e(this).parent().parent();a.find("> .palleon-tab").removeClass("active"),e(t).addClass("active"),a.find("> .palleon-tabs-menu li").removeClass("active"),e(this).addClass("active")}),a.find('input[type="number"],.numeric-field').bind("input paste keyup keydown",function(){this.value=this.value.replace(/(?!^-)[^0-9.]/g,"").replace(/(\..*)\./g,"$1"),e(this).data("max")&&this.value>e(this).data("max")&&(this.value=e(this).data("max")),e(this).data("min")&&this.value<e(this).data("min")&&(this.value=e(this).data("min"))}),a.find(".palleon-counter .counter-plus").on("click",function(){var t=e(this).parent().find("input.palleon-form-field"),a=parseInt(t.val())+parseInt(t.data("step"));t.data("max")&&a>t.data("max")&&(a=t.data("max")),t.data("min")&&a<t.data("min")&&(a=t.data("min")),a<0&&(a=0),t.val(a),"palleon-img-zoom-in"==e(this).attr("id")&&ed(a)}),a.find(".palleon-counter .counter-minus").on("click",function(){var t=e(this).parent().find("input.palleon-form-field"),a=parseInt(t.val())-parseInt(t.data("step"));t.data("max")&&a>t.data("max")&&(a=t.data("max")),t.data("min")&&a<t.data("min")&&(a=t.data("min")),a<0&&(a=0),t.val(a),"palleon-img-zoom-out"==e(this).attr("id")&&ed(a)}),a.find(".palleon-wrap").on("click",function(e){var t=e.target.id;""!=t&&"palleon-content"==t&&(v.discardActiveObject(),v.requestRenderAll())}),fabric.enableGLFiltering=i.enableGLFiltering,fabric.textureSize=parseInt(i.textureSize),fabric.Object.prototype.borderColor=i.borderColor,fabric.Object.prototype.borderDashArray=i.borderDashArray,fabric.Object.prototype.borderOpacityWhenMoving=i.borderOpacityWhenMoving,fabric.Object.prototype.borderScaleFactor=i.borderScaleFactor,fabric.Object.prototype.editingBorderColor=i.editingBorderColor,fabric.Object.prototype.cornerColor=i.cornerColor,fabric.Object.prototype.cornerSize=i.cornerSize,fabric.Object.prototype.cornerStrokeColor=i.cornerStrokeColor,fabric.Object.prototype.cornerStyle=i.cornerStyle,fabric.Object.prototype.transparentCorners=i.transparentCorners,fabric.Object.prototype.cursorColor=i.cursorColor,fabric.Object.prototype.cursorWidth=i.cursorWidth,fabric.Object.prototype.strokeUniform=!0,fabric.Group.prototype.padding=0,fabric.Object.prototype.erasable=!1;var Y=document.createElement("img");function z(t,n){var i=n.target;"activeSelection"===i.type?(e.each(i._objects,function(e,t){a.find("#palleon-layers #"+t.id).find("a.delete-layer").trigger("click")}),v.discardActiveObject()):a.find("#palleon-layers #"+i.id).find("a.delete-layer").trigger("click")}function X(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(Y,-12,-12,24,24),e.restore()}Y.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_delete_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='120.001' y='239.987' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='271.997' height='32'/%3E%3Crect x='240' y='119.989' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='32' height='271.997'/%3E%3C/g%3E%3C/svg%3E";var E=document.createElement("img");function W(e,t){var n=t.target;"activeSelection"===n.type?toastr.warning(palleonParams.noDuplicate,palleonParams.warning):a.find("#palleon-layers #"+n.id).find("a.duplicate-layer").trigger("click")}function B(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(E,-12,-12,24,24),e.restore()}function G(e,t){""==e&&(e=new Date().getTime()),""==t?t="jpeg":"jpg"==t&&(t="jpeg"),a.find(".palleon-file-name").val(e),a.find(".palleon-file-name").data("default",e),a.find("#palleon-save-img-format").val(t),a.find("#palleon-save-img-format").trigger("change")}function L(e){if(f=0,a.find("#palleon-canvas-loader").css("display","flex"),a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),r=e,v.backgroundImage&&(b=v.backgroundImage.filters),"canvas"==r){a.find("#palleon-canvas-color").trigger("change");var t=document.createElement("canvas"),n=new fabric.Canvas(t),i=parseInt(a.find("#palleon-canvas-width").val()),l=parseInt(a.find("#palleon-canvas-height").val());""==i&&(i=800),""==l&&(l=800),n.setWidth(i),n.setHeight(l),n.backgroundColor="transparent";var o=n.toDataURL({format:"png",enableRetinaScaling:!1});a.find("#palleon-canvas-img").attr("src",o),n.dispose()}a.find("#palleon-canvas-img-wrap").imagesLoaded(function(){s=a.find("#palleon-canvas-img")[0],d=a.find("#palleon-canvas-img").attr("src"),c=s.width,p=s.height,ec(s),v.setDimensions({width:c,height:p}),fabric.Image.fromURL(d,function(e){v.setBackgroundImage(e,v.renderAll.bind(v),{objectType:"BG",mode:r,scaleX:g,scaleY:h,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})}),ed(),H(),setTimeout(function(){M(),ei('<span class="material-icons">flag</span>'+palleonParams.started)},100),a.find("#palleon-canvas-loader").hide()})}if(E.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_add_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23009688;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='240' y='120' style='fill:%23FFFFFF;' width='32' height='272'/%3E%3Crect x='120' y='240' style='fill:%23FFFFFF;' width='272' height='32'/%3E%3C/g%3E%3C/svg%3E",fabric.Image.filters.Shift=fabric.util.createClass(fabric.Image.filters.ColorMatrix,{type:"Shift",matrix:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],mainParameter:!1,colorsOnly:!0}),l=a.find("#palleon-canvas")[0],(v=new fabric.Canvas(l)).backgroundColor=i.canvasColor,e(document).on("loadBase64Img",function(e,t,n){f=0,a.find("#palleon-canvas-loader").css("display","flex"),a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),r="image",v.backgroundImage&&(b=v.backgroundImage.filters),a.find("#palleon-canvas-img").attr("src",t),a.find("#palleon-canvas-img-wrap").imagesLoaded(function(){c=(s=a.find("#palleon-canvas-img")[0]).width,p=s.height,G(n,"png"),ec(s),v.setDimensions({width:c,height:p}),v.setBackgroundImage(t,v.renderAll.bind(v),{objectType:"BG",mode:r,scaleX:g,scaleY:h,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"}),ed(),H(),setTimeout(function(){M(),ei('<span class="material-icons">flag</span>'+palleonParams.started),a.find("#palleon-canvas-loader").hide()},500)})}),e(document).on("loadImgURL",function(e,t,n){a.find("#palleon-canvas-loader").css("display","flex"),a.find("#palleon-canvas-wrap").css("visibility","visible");var i=t,l=new Image;if("add-to-canvas"==x)G(D,n),F(i,function(e){l.src=e,l.onload=function(){a.find("#palleon-canvas-img").attr("src",e),L("image")}});else if("add-as-object"==x){var o=em()[1]/2,r=em()[0]/2,s=v.getObjects().filter(e=>"printarea"==e.objectType)[0];s&&(o=s.top,r=s.left),F(i,function(e){l.src=e,l.onload=function(){var e=new fabric.Image(l,{objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:o,left:r,originX:"center",originY:"center"});v.add(e),s?(e.scaleToWidth(.8*s.width*v.getZoom()),e.isContainedWithinObject(s)||e.scaleToHeight(.8*s.height*v.getZoom())):(e.scaleToWidth(em()[0]/4),e.isPartiallyOnScreen()&&e.scaleToHeight(em()[1]/4)),v.setActiveObject(e),v.requestRenderAll(),a.find("#palleon-canvas-loader").hide(),v.fire("palleon:history",{type:"image",text:palleonParams.added})}})}else"replace-image"==x?F(i,function(e){l.src=e,l.onload=function(){v.getActiveObject().setSrc(e),v.requestRenderAll(),a.find("#palleon-canvas-loader").hide(),v.fire("palleon:history",{type:"image",text:palleonParams.replaced})}}):"overlay-image"==x&&F(i,function(e){l.src=e,l.onload=function(){var e=new fabric.Image(l);e.set({scaleX:em()[0]/e.width,scaleY:em()[1]/e.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),v.setOverlayImage(e,v.renderAll.bind(v)),a.find("#palleon-overlay-wrap").show(),a.find("#palleon-overlay-preview").attr("src",i),setTimeout(function(){a.find("#palleon-canvas-loader").hide()},500)}});a.find("#modal-media-library").hide()}),""!=a.find("#palleon-canvas-img").attr("src")){r="image";var D=a.find("#palleon-canvas-img").data("filename");G(D,a.find("#palleon-canvas-img").attr("src").match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),L(r)}if(H(),""!=a.find("#palleon-canvas-img").data("template")){var D=a.find("#palleon-canvas-img").data("filename");a.find("#palleon-canvas-loader").css("display","flex"),a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),a.find(".palleon-modal").hide();var U=v.getObjects();U.filter(e=>"BG"!=e.objectType).forEach(e=>v.remove(e)),a.find("#palleon-layers li").remove(),eo(),e.getJSON(a.find("#palleon-canvas-img").data("template"),function(e){V(e),setTimeout(function(){ei('<span class="material-icons">flag</span>'+palleonParams.started),G(D,"")},100)}).fail(function(e,t,a){toastr.error("Request Failed: "+a,palleonParams.error)}).always(function(){a.find("#palleon-canvas-loader").hide()})}function M(){(f=0,g=1,h=1,m="left",u="top",void 0!==v.overlayImage&&null!==v.overlayImage&&(v.overlayImage=null),a.find("#keep-data").is(":checked"))?(v.backgroundImage.filters=b,v.backgroundImage.applyFilters()):(v.backgroundImage.filters=[],a.find("#palleon-adjust .conditional-settings").addClass("d-none"),a.find("#palleon-brightness").prop("checked",!1),a.find("#brightness").val(0),a.find("#palleon-contrast").prop("checked",!1),a.find("#contrast").val(0),a.find("#palleon-saturation").prop("checked",!1),a.find("#saturation").val(0),a.find("#palleon-hue").prop("checked",!1),a.find("#hue").val(0),a.find("#palleon-filters input[type=checkbox]").prop("checked",!1),a.find("#palleon-gamma").prop("checked",!1),a.find("#gamma-red").val(1),a.find("#gamma-green").val(1),a.find("#gamma-blue").val(1),a.find("#palleon-blend-color").prop("checked",!1),a.find("#blend-color-mode").val("add"),a.find("#blend-color-color").spectrum("set","#ffffff"),a.find("#blend-color-alpha").val(.5),a.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),a.find("#palleon-duotone-color").prop("checked",!1),a.find("#duotone-light-color").spectrum("set","green"),a.find("#duotone-dark-color").spectrum("set","blue"),a.find("#palleon-swap-colors").prop("checked",!1),a.find("#palleon-blur").prop("checked",!1),a.find("#blur").val(0),a.find("#palleon-noise").prop("checked",!1),a.find("#noise").val(0),a.find("#palleon-pixelate").prop("checked",!1),a.find("#pixelate").val(1),v.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>v.remove(e)),a.find("#palleon-layers li").remove(),eo()),v.fire("selection:cleared"),v.requestRenderAll()}function H(){"none"==r?(a.find("#palleon-icon-menu, #palleon-icon-panel, #palleon-ruler-icon").css("pointer-events","none"),a.find(".palleon-keep, #modal-add-new .palleon-modal-close").hide(),a.find("#modal-add-new").show(),a.find("#palleon-save").prop("disabled",!0)):(a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),a.find("#palleon-icon-menu, #palleon-icon-panel, #palleon-ruler-icon").css("pointer-events","auto"),a.find(".palleon-keep, #modal-add-new .palleon-modal-close").show(),a.find("#modal-add-new").hide(),a.find("#palleon-save").prop("disabled",!1)),"canvas"==r?a.find(".hide-on-canvas-mode").hide():a.find(".hide-on-canvas-mode").show()}function V(t){a.find("#palleon-canvas-loader").css("display","flex"),f=t.backgroundImage.angle,g=t.backgroundImage.scaleX,h=t.backgroundImage.scaleY,m=t.backgroundImage.originX,u=t.backgroundImage.originY,v.clear(),a.find("#palleon-layers li").remove(),r=t.backgroundImage.mode;var n=R(t.backgroundImage.src);d=URL.createObjectURL(n),a.find("#palleon-canvas-img").attr("src",d),c=t.backgroundImage.width;for(var l={width:c,height:p=t.backgroundImage.height},o=0;o<t.objects.length;o++)"textbox"==t.objects[o].objectType&&(t.objects[o].fontFamily=t.objects[o].fontFamily+"-palleon");v.loadFromJSON(t,function(){var t;0!==(t=v.getObjects().filter(e=>"textbox"==e.objectType)).length&&e.each(t,function(e,t){var a=t.fontFamily.replace("-palleon","");t.fontFamily=i.fontFamily;var n="yes";if(""==a)n="no";else for(var l=0;l<A.length;l++)if(A[l][1]==a){n="no";break}if("yes"==n){WebFont.load({google:{families:[a+":regular,bold",a+":italic,regular,bold"]}});var o=new FontFaceObserver(a,{weight:"normal",style:"normal"}),r=new FontFaceObserver(a,{weight:"bold",style:"normal"}),s=new FontFaceObserver(a,{weight:"normal",style:"italic"}),d=new FontFaceObserver(a,{weight:"bold",style:"italic"});Promise.all([o.load(null,5e3),r.load(null,5e3),s.load(null,5e3),d.load(null,5e3)]).then(function(){t.set("fontFamily",a),v.requestRenderAll()}).catch(function(e){console.log(e)})}else t.set("fontFamily",a),v.requestRenderAll()}),eo(),a.find("#palleon-canvas-color").spectrum("set",v.backgroundColor),a.find("#custom-image-background").spectrum("set",v.backgroundColor),s=a.find("#palleon-canvas-img")[0],v.requestRenderAll(),a.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),G(new Date().getTime(),""),ec(l),ed(),H(),v.fire("selection:cleared"),setTimeout(function(){if(a.find("#palleon-layers > li").removeClass("active"),t.backgroundImage){var n;n=t.backgroundImage.filters,a.find("#palleon-brightness").prop("checked",!1),a.find("#palleon-contrast").prop("checked",!1),a.find("#palleon-saturation").prop("checked",!1),a.find("#palleon-hue").prop("checked",!1),a.find("#grayscale").prop("checked",!1),a.find("#sepia").prop("checked",!1),a.find("#brownie").prop("checked",!1),a.find("#blackwhite").prop("checked",!1),a.find("#vintage").prop("checked",!1),a.find("#kodachrome").prop("checked",!1),a.find("#polaroid").prop("checked",!1),a.find("#technicolor").prop("checked",!1),a.find("#invert").prop("checked",!1),a.find("#sharpen").prop("checked",!1),a.find("#emboss").prop("checked",!1),a.find("#palleon-gamma").prop("checked",!1),a.find("#palleon-blend-color").prop("checked",!1),a.find("#palleon-duotone-color").prop("checked",!1),a.find("#palleon-blur").prop("checked",!1),a.find("#palleon-noise").prop("checked",!1),a.find("#palleon-pixelate").prop("checked",!1),0!==n.length&&e.each(n,function(e,t){"Brightness"==t.type?(a.find("#palleon-brightness").prop("checked",!0),a.find("#brightness").val(t.brightness),a.find("#brightness").parent().parent().find(".slider-label span").html(t.brightness)):"Contrast"==t.type?(a.find("#palleon-contrast").prop("checked",!0),a.find("#contrast").val(t.brightness),a.find("#contrast").parent().parent().find(".slider-label span").html(t.contrast)):"Saturation"==t.type?(a.find("#palleon-saturation").prop("checked",!0),a.find("#saturation").val(t.brightness),a.find("#saturation").parent().parent().find(".slider-label span").html(t.saturation)):"HueRotation"==t.type?(a.find("#palleon-hue").prop("checked",!0),a.find("#hue").val(t.rotation),a.find("#hue").parent().parent().find(".slider-label span").html(t.rotation)):"Grayscale"==t.type?a.find("#grayscale").prop("checked",!0):"Sepia"==t.type?a.find("#sepia").prop("checked",!0):"Brownie"==t.type?a.find("#brownie").prop("checked",!0):"BlackWhite"==t.type?a.find("#blackwhite").prop("checked",!0):"Vintage"==t.type?a.find("#vintage").prop("checked",!0):"Kodachrome"==t.type?a.find("#kodachrome").prop("checked",!0):"Polaroid"==t.type?a.find("#polaroid").prop("checked",!0):"Technicolor"==t.type?a.find("#technicolor").prop("checked",!0):"Invert"==t.type?a.find("#invert").prop("checked",!0):"Convolute"==t.type?"[0,-1,0,-1,5,-1,0,-1,0]"==t.matrix?a.find("#sharpen").prop("checked",!0):"[1,1,1,1,0.7,-1,-1,-1,-1]"==t.matrix?a.find("#emboss").prop("checked",!0):"[-1,0,1,-2,0,2,-1,0,1]"==t.matrix?a.find("#sobelX").prop("checked",!0):"[-1,-2,-1,0,0,0,1,2,1]"==t.matrix&&a.find("#sobelY").prop("checked",!0):"Gamma"==t.type?(a.find("#palleon-gamma").prop("checked",!0),a.find("#gamma-red").val(t.gamma[0]),a.find("#gamma-red").parent().parent().find(".slider-label span").html(t.gamma[0]),a.find("#gamma-green").val(t.gamma[1]),a.find("#gamma-green").parent().parent().find(".slider-label span").html(t.gamma[1]),a.find("#gamma-blue").val(t.gamma[2]),a.find("#gamma-blue").parent().parent().find(".slider-label span").html(t.gamma[2])):"BlendColor"==t.type?(a.find("#palleon-blend-color").prop("checked",!0),a.find("#blend-color-mode").val(t.mode),a.find("#blend-color-color").val(t.color),a.find("#blend-color-alpha").val(t.alpha),a.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(t.alpha)):"Composed"==t.type?(a.find("#palleon-duotone-color").prop("checked",!0),a.find("#duotone-light-color").val(t.subFilters[1].color),a.find("#duotone-dark-color").val(t.subFilters[2].color)):"Blur"==t.type?(a.find("#palleon-blur").prop("checked",!0),a.find("#blur").val(t.blur),a.find("#blur").parent().parent().find(".slider-label span").html(t.blur)):"Noise"==t.type?(a.find("#palleon-noise").prop("checked",!0),a.find("#noise").val(t.noise),a.find("#noise").parent().parent().find(".slider-label span").html(t.noise)):"Pixelate"==t.type&&(a.find("#palleon-pixelate").prop("checked",!0),a.find("#pixelate").val(t.blocksize),a.find("#pixelate").parent().parent().find(".slider-label span").html(t.blocksize))}),a.find("#palleon-brightness").trigger("change"),a.find("#palleon-contrast").trigger("change"),a.find("#palleon-saturation").trigger("change"),a.find("#palleon-hue").trigger("change"),a.find("#palleon-gamma").trigger("change"),a.find("#palleon-blend-color").trigger("change"),a.find("#palleon-blur").trigger("change"),a.find("#palleon-noise").trigger("change"),a.find("#palleon-pixelate").trigger("change")}t.overlayImage?(a.find("#palleon-overlay-wrap").show(),a.find("#palleon-overlay-preview").attr("src",t.overlayImage.src)):(a.find("#palleon-overlay-wrap").hide(),a.find("#palleon-overlay-preview").attr("src",""))},100)}function N(){if(i.watermark){var e=i.watermarkLocation,t=c*i.watermarkFontSize/1400,a=new fabric.Textbox(" "+i.watermarkText+" ",{objectType:"watermark",gradientFill:"none",fontSize:t,fontFamily:i.watermarkFontFamily,fontWeight:i.watermarkFontWeight,fontStyle:i.watermarkFontStyle,lineHeight:1,fill:i.watermarkFontColor,textBackgroundColor:i.watermarkBackgroundColor,width:em()[0],left:0});v.add(a),"bottom-right"==e?(a.textAlign="right",a.top=em()[1]-a.height):"bottom-left"==e?(a.textAlign="left",a.top=em()[1]-a.height):"top-right"==e?(a.textAlign="right",a.top=0):"top-left"==e&&(a.textAlign="left",a.top=0),a.moveTo(999)}}function Z(){i.watermark&&(U=v.getObjects()).filter(e=>"watermark"===e.objectType).forEach(e=>v.remove(e))}function J(e){if(!e._objects)return!0;if("object"!=typeof e._objects[0].get("fill")){var t=(e._objects[0].get("fill")||"").toLowerCase();return e._objects.every(function(e){return(e.get("fill")||"").toLowerCase()===t})}}a.find(".palleon-modal-open").on("click",function(t){t.preventDefault();var n=e(this).data("target");a.find(".palleon-modal").hide(),a.find(n).show()}),a.find(".palleon-modal-close").on("click",function(t){t.preventDefault();var n=e(this).data("target");a.find(n).hide()}),a.find("#palleon-image-upload").on("change",function(){a.find(".palleon-modal").hide(),a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible");var e,t=new FileReader;t.onload=function(e){a.find("#palleon-canvas-img").attr("src",t.result),L("image")},t.readAsDataURL(this.files[0]),G(this.files[0].name.replace(/\.[^/.]+$/,""),this.files[0].name.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""))}),a.find("#palleon-canvas-create").on("click",function(){G(new Date().getTime(),""),L("canvas")}),a.find("#palleon-template-search").on("click",function(){var t=a.find("#palleon-templates-menu").val(),n=e(this).parent().find("input");if(a.find("#palleon-all-templates-noimg").addClass("d-none"),a.find("#palleon-templates-grid .grid-item").each(function(){e(this).attr("data-keyword",e(this).data("keyword").toLowerCase())}),e(this).hasClass("cancel"))a.find("#palleon-templates-menu").val("all").change(),a.find("#palleon-templates-menu").parent().find("span.select2-container").css("opacity",1),e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),n.val(""),a.find("#palleon-templates-grid .grid-item").show(),a.find("#palleon-templates-grid-pagination").length&&(a.find("#palleon-templates-grid-pagination").pagination("redraw"),a.find("#palleon-templates-grid-pagination").pagination("selectPage",1)),n.prop("disabled",!1),a.find("#palleon-templates-menu").prop("disabled",!1);else{a.find("#palleon-templates-menu").parent().find("span.select2-container").css("opacity",.5),e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var i=n.val().toLowerCase().replace(/\s/g," ");(""==i||i.length<1)&&"all"==t?(a.find("#palleon-templates-grid .grid-item").show(),a.find("#palleon-templates-grid-pagination").length&&(a.find("#palleon-templates-grid-pagination").pagination("redraw"),a.find("#palleon-templates-grid-pagination").pagination("selectPage",1))):(a.find("#palleon-templates-grid-pagination").length&&a.find("#palleon-templates-grid-pagination").pagination("destroy"),"all"==t?(""!=i||i.length>1)&&a.find("#palleon-templates-grid .grid-item").hide().filter('[data-keyword*="'+i+'"]').show():""!=i||i.length>1?a.find("#palleon-templates-grid .grid-item").hide().filter('[data-keyword*="'+i+'"]').filter('[data-category*="'+t+'"]').show():a.find("#palleon-templates-grid .grid-item").hide().filter('[data-category*="'+t+'"]').show(),0===a.find("#palleon-templates-grid .grid-item:visible").length&&a.find("#palleon-all-templates-noimg").removeClass("d-none")),n.prop("disabled",!0),a.find("#palleon-templates-menu").prop("disabled",!0)}}),a.find("#palleon-json-save").on("click",function(){var e=v.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName","maskType"]);F(e.backgroundImage.src,function(t){e.backgroundImage.src=t;var n=JSON.stringify(e),i=Math.random().toString(36).substr(2,9),l=a.find("#palleon-save-img-name").val();try{o.collection("assets").add({key:i,src:n,name:l,type:"json"}).then(e=>{toastr.success(palleonParams.tempsaved,palleonParams.saved),I()})}catch(r){toastr.error(r.message,palleonParams.error)}a.find(".palleon-modal").hide()})}),a.find("#palleon-json-download").on("click",function(){var e=a.find("#palleon-json-download-name").val(),t=v.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName","maskType"]);F(t.backgroundImage.src,function(n){t.backgroundImage.src=n;var i=JSON.stringify(t),l=document.createElement("a"),o=new Blob([i],{type:"text/plain"});l.href=URL.createObjectURL(o),l.download=e+".json",l.click(),a.find(".palleon-modal").hide()})}),a.find("#palleon-json-upload").on("change",function(e){a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),a.find("#palleon-canvas-loader").css("display","flex");var t=new FileReader,n="";t.onload=function(e){V(n=JSON.parse(t.result)),a.find("#palleon-canvas-loader").hide(),setTimeout(function(){ei('<span class="material-icons">flag</span>'+palleonParams.started)},100)},t.readAsText(e.target.files[0]),a.find(".palleon-modal").hide()}),i.templatePreview&&a.find("#palleon-templates-grid").on("mouseenter",".palleon-select-template",function(){var t=e(this).find("img.lazy").data("title"),a=e(this).find("img.lazy").data("preview");e(this).append('<div id="palleon-template-preview"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="'+a+'" /></div><div id="palleon-template-preview-title">'+t+"</div></div>"),T.update()}).on("mousemove",".palleon-select-template",function(e){jQuery("#palleon-template-preview").position({my:"left+20 top",of:e,collision:"fit flip"})}).on("mouseleave",".palleon-select-template",function(){jQuery("#palleon-template-preview").remove()}),a.find(".template-selection").on("click",".palleon-select-template",function(){a.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),a.find(".palleon-modal").hide(),a.find("#palleon-canvas-loader").css("display","flex"),v.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>v.remove(e)),a.find("#palleon-layers li").remove(),eo(),e.getJSON(e(this).data("json"),function(e){V(e),setTimeout(function(){ei('<span class="material-icons">flag</span>'+palleonParams.started)},100)}).fail(function(e,t,a){toastr.error("Request Failed: "+a,palleonParams.error)}).always(function(){a.find("#palleon-canvas-loader").hide()})}),a.find("#palleon-my-templates-search").on("click",function(){var t=e(this).parent().find("input");if(a.find("#palleon-my-templates-noimg").addClass("d-none"),a.find("#palleon-my-templates li").each(function(){e(this).attr("data-keyword",e(this).data("keyword").toLowerCase())}),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),a.find("#palleon-my-templates li").show(),a.find("#palleon-my-templates-pagination").length&&(a.find("#palleon-my-templates-pagination").pagination("redraw"),a.find("#palleon-my-templates-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=t.val().toLowerCase().replace(/\s/g," ");console.log(n),""==n||n.length<1?(a.find("#palleon-my-templates li").show(),a.find("#palleon-my-templates-pagination").length&&(a.find("#palleon-my-templates-pagination").pagination("redraw"),a.find("#palleon-my-templates-pagination").pagination("selectPage",1))):(a.find("#palleon-my-templates-pagination").length&&a.find("#palleon-my-templates-pagination").pagination("destroy"),a.find("#palleon-my-templates li").hide().filter('[data-keyword*="'+n+'"]').show(),0===a.find("#palleon-my-templates li:visible").length&&a.find("#palleon-my-templates-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),a.find("#palleon-download").on("click",function(){var t=a.find("#palleon-download-name").val(),n=parseFloat(a.find("#palleon-download-quality").val()),i=a.find("#palleon-download-format").val(),l=document.createElement("a");N(),v.setZoom(1),a.find("#palleon-img-zoom").val(100);var o=p,r=c;(0==f||180==f||-180==f)&&(o=c,r=p),v.setWidth(o),v.setHeight(r);var s="";if("svg"==i){var d=v.toSVG({suppressPreamble:!1,width:c,height:p}),g=v.getObjects().filter(e=>"textbox"==e.objectType),h='<defs><style type="text/css"><![CDATA[',m=[],u="";e.each(g,function(e,t){for(var a=t.fontFamily,n="yes",i=0;i<A.length;i++)if(A[i][1]==a){n="no";break}"yes"!=n||m.includes(a)||m.push(a)}),m.length>0?e.each(m,function(a,n){var o=a==m.length-1,r=n.replace(/ /g,"+");e.ajax({url:"https://fonts.googleapis.com/css?family="+r+":italic,regular,bold",type:"GET",dataType:"text",crossDomain:!0,success:function(e){h+=e,setTimeout(function(){o&&(d=d.replace("<defs>",h+"]]></style>"),s=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(s),l.download=t+"."+i,l.href=u,l.click())},500)},error:function(e,t,a){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}):(s=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(s),l.download=t+"."+i,l.href=u,l.click())}else{var b=v.toDataURL({format:i,quality:n,enableRetinaScaling:!1});"webp"!=i&&(b=changeDpiDataUrl(b,a.find("#palleon-download-img-dpi").val())),s=R(b),u=URL.createObjectURL(s),l.download=t+"."+i,l.href=u,l.click()}Z(),ed(),v.requestRenderAll(),a.find(".palleon-modal").hide()}),a.find("#palleon-download-format").on("change",function(){"png"==e(this).val()||"svg"==e(this).val()?a.find("#palleon-download-quality").prop("disabled",!0):a.find("#palleon-download-quality").prop("disabled",!1)}),a.find("#palleon-save-img-format").on("change",function(){"png"==e(this).val()||"svg"==e(this).val()?a.find("#palleon-save-img-quality").prop("disabled",!0):a.find("#palleon-save-img-quality").prop("disabled",!1)}),a.find("#palleon-canvas-size-select").on("change",function(){"custom"==e(this).val()?(a.find("#palleon-canvas-width").prop("disabled",!1),a.find("#palleon-canvas-height").prop("disabled",!1)):(a.find("#palleon-canvas-width").prop("disabled",!0),a.find("#palleon-canvas-height").prop("disabled",!0)),a.find("#palleon-canvas-width").val(e(this).find(":selected").data("width")),a.find("#palleon-canvas-height").val(e(this).find(":selected").data("height"))}),a.find("#palleon-canvas-color").on("change",function(){var t=e(this).val();a.find("#custom-image-background").spectrum("set",t),""==t?(v.backgroundColor="transparent",v.requestRenderAll()):(v.backgroundColor=t,v.requestRenderAll())}),a.find("#palleon-media-library").on("click",function(){x="add-to-canvas"}),a.find("#palleon-img-media-library").on("click",function(){x="add-as-object"}),a.find("#palleon-img-replace-media-library").on("click",function(){x="replace-image"}),a.find("#palleon-overlay-img-media-library").on("click",function(){x="overlay-image"}),a.find("#modal-media-library").on("click",".media-library-grid>.palleon-masonry-item>.palleon-masonry-item-inner",function(){a.find("#palleon-canvas-loader").css("display","flex"),a.find("#palleon-canvas-wrap").css("visibility","visible");var t=e(this).find("img").data("full"),n=new Image;if("add-to-canvas"==x){var i="",l=e(this).find("img").data("filename");if(e(this).find("img").data("format"))i=e(this).find("img").data("format");else{var o=t.substring(0,t.indexOf("?"));i=""!=o?o.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""):t.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")}G(l,i),F(t,function(e){n.src=e,n.onload=function(){a.find("#palleon-canvas-img").attr("src",e),L("image")}})}else"add-as-object"==x?F(t,function(e){n.src=e,n.onload=function(){var e=new fabric.Image(n,{objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:em()[1]/2,left:em()[0]/2,originX:"center",originY:"center"});v.add(e),e.scaleToWidth(em()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(em()[1]/2),v.setActiveObject(e),v.requestRenderAll(),a.find("#palleon-canvas-loader").hide(),v.fire("palleon:history",{type:"image",text:palleonParams.added})}}):"replace-image"==x?F(t,function(e){n.src=e,n.onload=function(){v.getActiveObject().setSrc(e),v.requestRenderAll(),a.find("#palleon-canvas-loader").hide(),v.fire("palleon:history",{type:"image",text:palleonParams.replaced})}}):"overlay-image"==x&&fabric.Image.fromURL(t,function(e){e.set({scaleX:em()[0]/e.width,scaleY:em()[1]/e.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),v.setOverlayImage(e,v.renderAll.bind(v)),a.find("#palleon-overlay-wrap").show(),a.find("#palleon-overlay-preview").attr("src",t),setTimeout(function(){a.find("#palleon-canvas-loader").hide()},500)});a.find("#modal-media-library").hide()}),a.find("#palleon-library-my-search").on("click",function(){var t=e(this).parent().find("input");if(a.find("#palleon-library-my-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),a.find("#palleon-library-my .palleon-masonry-item").show(),a.find("#palleon-library-my-pagination").length&&(a.find("#palleon-library-my-pagination").pagination("redraw"),a.find("#palleon-library-my-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=t.val().toLowerCase().replace(/\s/g," ");""==n||n.length<1?(a.find("#palleon-library-my .palleon-masonry-item").show(),a.find("#palleon-library-my-pagination").length&&(a.find("#palleon-library-my-pagination").pagination("redraw"),a.find("#palleon-library-my-pagination").pagination("selectPage",1))):(a.find("#palleon-library-my-pagination").length&&a.find("#palleon-library-my-pagination").pagination("destroy"),a.find("#palleon-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===a.find("#palleon-library-my .palleon-masonry-item:visible").length&&a.find("#palleon-library-my-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),a.find("#palleon-library-all-search").on("click",function(){var t=e(this).parent().find("input");if(a.find("#palleon-library-all-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),a.find("#palleon-library-all .palleon-masonry-item").show(),a.find("#palleon-library-all-pagination").length&&(a.find("#palleon-library-all-pagination").pagination("redraw"),a.find("#palleon-library-all-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=t.val().toLowerCase().replace(/\s/g," ");""==n||n.length<1?(a.find("#palleon-library-all .palleon-masonry-item").show(),a.find("#palleon-library-all-pagination").length&&(a.find("#palleon-library-all-pagination").pagination("redraw"),a.find("#palleon-library-all-pagination").pagination("selectPage",1))):(a.find("#palleon-library-all-pagination").length&&a.find("#palleon-library-all-pagination").pagination("destroy"),a.find("#palleon-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===a.find("#palleon-library-all .palleon-masonry-item:visible").length&&a.find("#palleon-library-all-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),a.find("#palleon-save-img").on("click",function(){var t=parseFloat(a.find("#palleon-save-img-quality").val()),n=a.find("#palleon-save-img-format").val(),i=a.find("#palleon-save-img-name").val(),l="";N(),v.setZoom(1),a.find("#palleon-img-zoom").val(100);var r=p,s=c;if((0==f||180==f||-180==f)&&(r=c,s=p),v.setWidth(r),v.setHeight(s),"svg"==n){l=v.toSVG({suppressPreamble:!1,width:c,height:p});var d=v.getObjects().filter(e=>"textbox"==e.objectType),g='<defs><style type="text/css"><![CDATA[',h=[];e.each(d,function(e,t){for(var a=t.fontFamily,n="yes",i=0;i<A.length;i++)if(A[i][1]==a){n="no";break}"yes"!=n||h.includes(a)||h.push(a)}),h.length>0&&e.each(h,function(t,a){var n=t==h.length-1,i=a.replace(/ /g,"+");e.ajax({url:"https://fonts.googleapis.com/css?family="+i+":italic,regular,bold",type:"GET",dataType:"text",crossDomain:!0,success:function(e){g+=e,setTimeout(function(){n&&(l=l.replace("<defs>",g+"]]></style>"))},500)},error:function(e,t,a){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})})}else l=v.toDataURL({format:n,quality:t,enableRetinaScaling:!1}),"webp"!=n&&(l=changeDpiDataUrl(l,a.find("#palleon-download-img-dpi").val()));var m=Math.random().toString(36).substr(2,9);try{o.collection("assets").add({key:m,src:l,name:i,type:n}).then(e=>{toastr.success(palleonParams.imgsaved,palleonParams.saved),I()})}catch(u){toastr.error(u.message,palleonParams.error)}a.find(".palleon-modal").hide(),Z(),ed(),v.requestRenderAll()}),a.find("#palleon-library-upload-img").on("change",function(e){var t=new FileReader;t.fileName=this.files[0].name,t.onload=function(e){var t=new Image;F(e.target.result,function(a){t.src=a,t.onload=function(){var t=Math.random().toString(36).substr(2,9);try{o.collection("assets").add({key:t,src:a,name:e.target.fileName,type:e.target.fileName.match(/\.[0-9a-z]+$/i)}).then(e=>{I()})}catch(n){toastr.error(n.message,palleonParams.error)}}})},t.readAsDataURL(e.target.files[0])}),a.find(".svg-library-grid").on("click",">.palleon-masonry-item>.palleon-masonry-item-inner",function(){var t=e(this).find("img").data("full");fabric.loadSVGFromURL(t,function(e,t){var a=fabric.util.groupSVGElements(e,t);a.set("originX","center"),a.set("originY","center"),a.set("left",em()[0]/2),a.set("top",em()[1]/2),J(a)?(a.set("objectType","element"),v.fire("palleon:history",{type:"element",text:palleonParams.added})):(a.set("objectType","customSVG"),v.fire("palleon:history",{type:"customSVG",text:palleonParams.added})),a.scaleToWidth(em()[0]/2),a.scaleToHeight(em()[1]/2),v.add(a),v.setActiveObject(a),v.requestRenderAll()},function(){},{crossOrigin:"anonymous"}),a.find("#modal-svg-library").hide()}),a.find("#palleon-svg-library-my-search").on("click",function(){var t=e(this).parent().find("input");if(a.find("#palleon-svg-library-my-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),a.find("#palleon-svg-library-my .palleon-masonry-item").show(),a.find("#palleon-svg-library-my-pagination").length&&(a.find("#palleon-svg-library-my-pagination").pagination("redraw"),a.find("#palleon-svg-library-my-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=t.val().toLowerCase().replace(/\s/g," ");""==n||n.length<1?(a.find("#palleon-svg-library-my .palleon-masonry-item").show(),a.find("#palleon-svg-library-my-pagination").length&&(a.find("#palleon-svg-library-my-pagination").pagination("redraw"),a.find("#palleon-svg-library-my-pagination").pagination("selectPage",1))):(a.find("#palleon-svg-library-my-pagination").length&&a.find("#palleon-svg-library-my-pagination").pagination("destroy"),a.find("#palleon-svg-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===a.find("#palleon-svg-library-my .palleon-masonry-item:visible").length&&a.find("#palleon-svg-library-my-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),a.find("#palleon-svg-library-all-search").on("click",function(){var t=e(this).parent().find("input");if(a.find("#palleon-library-all-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),a.find("#palleon-svg-library-all .palleon-masonry-item").show(),a.find("#palleon-svg-library-all-pagination").length&&(a.find("#palleon-svg-library-all-pagination").pagination("redraw"),a.find("#palleon-svg-library-all-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=t.val().toLowerCase().replace(/\s/g," ");""==n||n.length<1?(a.find("#palleon-svg-library-all .palleon-masonry-item").show(),a.find("#palleon-svg-library-all-pagination").length&&(a.find("#palleon-svg-library-all-pagination").pagination("redraw"),a.find("#palleon-svg-library-all-pagination").pagination("selectPage",1))):(a.find("#palleon-svg-library-all-pagination").length&&a.find("#palleon-svg-library-all-pagination").pagination("destroy"),a.find("#palleon-svg-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===a.find("#palleon-svg-library-all .palleon-masonry-item:visible").length&&a.find("#palleon-svg-library-all-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),a.find("#palleon-svg-library-upload-img").on("change",function(e){var t=new FileReader;t.fileName=this.files[0].name,t.onload=function(e){var t=atob(e.target.result.replace(/data:image\/svg\+xml;base64,/,"")),a=Math.random().toString(36).substr(2,9);try{o.collection("assets").add({key:a,src:t,name:e.target.fileName,type:"svg"}).then(e=>{I()})}catch(n){toastr.error(n.message,palleonParams.error)}},t.readAsDataURL(e.target.files[0])});var K=i.PexelsApiKey,Q=i.PixabayApiKey;function ee(e){if(!e.ok)throw Error(e.status);return e}if(""!=K){function et(t,n){var l=a.find("#pexels-orientation").val(),o=a.find("#pexels-color").val(),r=a.find("#palleon-pexels-keyword").val(),s="",d="";""==l&&""==o&&""==r?s="https://api.pexels.com/v1/curated?locale="+i.PexelsLanguage+"&page="+n+"&per_page="+i.PexelsPagination:(s="https://api.pexels.com/v1/search?locale="+i.PexelsLanguage+"&",""!=r?s+="query="+(r=encodeURIComponent(r))+"&":s+="query=&",""!=l&&(s+="orientation="+l+"&"),""!=o&&(s+="color="+o+"&"),s+="page="+n+"&per_page="+i.PexelsPagination);var c='<div class="palleon-grid media-library-grid pexels-grid">',p="</div>",f='<button id="pexels-loadmore" type="button" class="palleon-btn palleon-lg-btn primary" autocomplete="off" data-page="'+parseInt(n)+'">'+palleonParams.loadMore+"</button>";i.apiCaching&&sessionStorage.getItem(s)?("search"==t?a.find("#pexels-output").html(c+sessionStorage.getItem(s)+p+f):(a.find("#pexels-output > .pexels-grid").append(sessionStorage.getItem(s)),a.find("#pexels-loadmore").remove(),a.find("#pexels-output > .pexels-grid").after(f)),T.update(),a.find("#pexels").css("pointer-events","auto"),a.find("#pexels-menu,#pexels-output").css("opacity",1)):fetch(s,{method:"GET",headers:{Authorization:K},redirect:"follow"}).then(ee).then(e=>e.json()).then(n=>{var l=n.photos;""==l?(d='<div class="notice notice-warning">'+palleonParams.nothing+"</div>","search"==t?a.find("#pexels-output").html(d):a.find("#pexels-loadmore").prop("disabled",!0)):(e.each(l,function(e,t){var a=t.id,n=t.url,l=t.src,o=l.tiny,r=l[i.PexelsImgSize],s=t.alt;d+='<div class="palleon-masonry-item">',d+='<a href="'+n+'" class="pexels-url" target="_blank"><span class="material-icons">info</span></a>',d+='<div class="palleon-masonry-item-inner">',d+='<div class="palleon-img-wrap">',d+='<div class="palleon-img-loader"></div>',d+='<img class="lazy" data-src="'+o+'" data-full="'+r+'" data-id="'+a+'" data-filename="pexels-'+a+'" title="'+s+'" />',d+="</div>",""!=s&&(d+='<div class="palleon-masonry-item-desc">'+s+"</div>"),d+="</div></div>"}),"search"==t?a.find("#pexels-output").html(c+d+p+f):(a.find("#pexels-output > .pexels-grid").append(d),a.find("#pexels-loadmore").remove(),a.find("#pexels-output > .pexels-grid").after(f)),i.apiCaching&&sessionStorage.setItem(s,d),T.update()),a.find("#pexels").css("pointer-events","auto"),a.find("#pexels-menu,#pexels-output").css("opacity",1)}).catch(e=>{toastr.error(palleonParams.pexelsApiError,e),a.find("#pexels").css("pointer-events","auto"),a.find("#pexels-menu,#pexels-output").css("opacity",1)})}et("search","1"),a.find("#palleon-pexels-search").on("click",function(){a.find("#pexels").css("pointer-events","none"),a.find("#pexels-menu,#pexels-output").css("opacity",.5),et("search","1")}),a.find("#pexels-output").on("click","#pexels-loadmore",function(){a.find("#pexels").css("pointer-events","none"),a.find("#pexels-menu,#pexels-output").css("opacity",.5),et("loadmore",parseInt(e(this).data("page"))+1)}),a.find("#palleon-pexels-keyword").on("keyup input",function(){""==e(this).val()?(a.find("#pexels-orientation").val(""),a.find("#pexels-color").val(""),a.find("#pexels-orientation").prop("disabled",!0),a.find("#pexels-color").prop("disabled",!0)):(a.find("#pexels-orientation").prop("disabled",!1),a.find("#pexels-color").prop("disabled",!1))})}if(""!=Q){function ea(t,n){var l=a.find("#pixabay-orientation").val(),o=a.find("#pixabay-color").val(),r=a.find("#palleon-pixabay-keyword").val(),s=a.find("#pixabay-category").val(),d="",c="";""==l&&""==o&&""==r&&""==s?d="https://pixabay.com/api/?key="+Q+"&editors_choice=true&order=latest&image_type=photo&lang="+i.PixabayLanguage+"&safesearch="+i.PixabaySafeSearch+"&page="+n+"&per_page="+i.PixabayPagination:(d="https://pixabay.com/api/?key="+Q+"&image_type=photo&order=latest&lang="+i.PixabayLanguage+"&safesearch="+i.PixabaySafeSearch+"&editors_choice="+i.PixabayEditorsChice+"&",""!=r&&(d+="q="+(r=encodeURIComponent(r))+"&"),""!=l&&(d+="orientation="+l+"&"),""!=o&&(d+="color="+o+"&"),""!=s&&(d+="category="+s+"&"),d+="page="+n+"&per_page="+i.PixabayPagination);var p='<div class="palleon-grid media-library-grid pixabay-grid">',f="</div>",g='<button id="pixabay-loadmore" type="button" class="palleon-btn palleon-lg-btn primary" autocomplete="off" data-page="'+parseInt(n)+'">'+palleonParams.loadMore+"</button>";i.apiCaching&&sessionStorage.getItem(d)?("search"==t?a.find("#pixabay-output").html(p+sessionStorage.getItem(d)+f+g):(a.find("#pixabay-output > .pixabay-grid").append(sessionStorage.getItem(d)),a.find("#pixabay-loadmore").remove(),a.find("#pixabay-output > .pixabay-grid").after(g)),T.update(),a.find("#pixabay").css("pointer-events","auto"),a.find("#pixabay-menu,#pixabay-output").css("opacity",1)):e.ajax({url:d,type:"POST",timeout:0,crossDomain:!0,processData:!1,contentType:!1,success:function(n){if(n){if(parseInt(n.totalHits)>0){var l=n.hits;e.each(l,function(e,t){var a=t.id,n=t.pageURL,i=t.webformatURL,l=t.largeImageURL;void 0!==t.fullHDURL&&(l=t.fullHDURL);var o=t.tags;c+='<div class="palleon-masonry-item">',c+='<a href="'+n+'" class="pixabay-url" target="_blank"><span class="material-icons">info</span></a>',c+='<div class="palleon-masonry-item-inner">',c+='<div class="palleon-img-wrap">',c+='<div class="palleon-img-loader"></div>',c+='<img class="lazy" data-src="'+i+'" data-full="'+l+'" data-id="'+a+'" data-filename="pixabay-'+a+'" title="'+o+'" />',c+="</div>",""!=o&&(c+='<div class="palleon-masonry-item-desc">'+o+"</div>"),c+="</div></div>"}),"search"==t?a.find("#pixabay-output").html(p+c+f+g):(a.find("#pixabay-output > .pixabay-grid").append(c),a.find("#pixabay-loadmore").remove(),a.find("#pixabay-output > .pixabay-grid").after(g)),i.apiCaching&&sessionStorage.setItem(d,c),T.update()}else c='<div class="notice notice-warning">'+palleonParams.nothing+"</div>","search"==t?a.find("#pixabay-output").html(c):a.find("#pixabay-loadmore").prop("disabled",!0);a.find("#pixabay").css("pointer-events","auto"),a.find("#pixabay-menu,#pixabay-output").css("opacity",1)}},error:function(e,t,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error),a.find("#pixabay").css("pointer-events","auto"),a.find("#pixabay-menu,#pixabay-output").css("opacity",1)}})}ea("search","1"),a.find("#palleon-pixabay-search").on("click",function(){a.find("#pixabay").css("pointer-events","none"),a.find("#pixabay-menu,#pixabay-output").css("opacity",.5),ea("search","1")}),a.find("#pixabay-output").on("click","#pixabay-loadmore",function(){a.find("#pixabay").css("pointer-events","none"),a.find("#pixabay-menu,#pixabay-output").css("opacity",.5),ea("loadmore",parseInt(e(this).data("page"))+1)})}function en(e){var t=palleonParams.object,a="category";return null==e?(t=palleonParams.object,a="category"):"textbox"==e?(t=palleonParams.text,a="title"):"drawing"==e?(t=palleonParams.freeDrawing,a="brush"):"frame"==e?(t=palleonParams.frame,a="wallpaper"):"image"==e?(t=palleonParams.image,a="image"):"circle"==e?t=palleonParams.circle:"square"==e?t=palleonParams.square:"rectangle"==e?t=palleonParams.rectangle:"triangle"==e?t=palleonParams.triangle:"ellipse"==e?t=palleonParams.ellipse:"trapezoid"==e?t=palleonParams.trapezoid:"pentagon"==e?t=palleonParams.pentagon:"octagon"==e?t=palleonParams.octagon:"emerald"==e?t=palleonParams.emerald:"diamond"==e?t=palleonParams.diamond:"parallelogram"==e?t=palleonParams.parallelogram:"star"==e?t=palleonParams.star:"element"==e?(t=palleonParams.element,a="star"):"BG"==e?(t=palleonParams.bg,a="image"):"customShape"==e?t=palleonParams.customShape:"customSVG"==e?t=palleonParams.customSvg:"apps"==e&&(t=palleonParams.app,a="apps"),'<span class="material-icons">'+a+"</span>"+t}function ei(e){var t,n=a.find("#palleon-history-list"),i=new Date,l=String(i.getHours()).padStart(2,"0")+":"+String(i.getMinutes()).padStart(2,"0")+":"+String(i.getSeconds()).padStart(2,"0"),o=v.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName","maskType"]);a.find("#palleon-history").prop("disabled",!1),n.find("li").removeClass("active"),n.prepend('<li class="active"><div class="info">'+e+'<span class="time">'+l+'</span></div><div><button type="button" class="palleon-btn primary"><span class="material-icons">restore</span>Restore</button><button type="button" class="palleon-btn danger"><span class="material-icons">clear</span>Delete</button><script type="text/json">'+JSON.stringify(o)+"</script></div></li>"),n.find("li").length>n.data("max")&&n.find("li").last().remove(),a.find("#palleon-history-count").html(n.find("li").length);var r=n.find("li.active").next("li"),s=n.find("li.active").prev("li");r.length?a.find("#palleon-undo").prop("disabled",!1):a.find("#palleon-undo").prop("disabled",!0),s.length?a.find("#palleon-redo").prop("disabled",!1):a.find("#palleon-redo").prop("disabled",!0)}a.find("#palleon-undo").on("click",function(){var e=a.find("#palleon-history-list li.active").next("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),a.find("#palleon-redo").prop("disabled",!1)):a.find("#palleon-undo").prop("disabled",!0)}),a.find("#palleon-redo").on("click",function(){var e=a.find("#palleon-history-list li.active").prev("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),a.find("#palleon-undo").prop("disabled",!1)):a.find("#palleon-redo").prop("disabled",!0)}),a.find("#palleon-history-list").on("click",".palleon-btn.danger",function(){e(this).parent().parent().remove(),e("#palleon-history-list li").length||(a.find("#palleon-history").prop("disabled",!0),a.find("#palleon-undo").prop("disabled",!0),a.find("#palleon-redo").prop("disabled",!0),a.find(".palleon-modal").hide())}),a.find("#palleon-history-list").on("click",".palleon-btn.primary",function(){a.find("#palleon-history-list li").removeClass("active"),e(this).parent().parent().addClass("active");var t=a.find("#palleon-history-list li.active").next("li"),n=a.find("#palleon-history-list li.active").prev("li");t.length?a.find("#palleon-undo").prop("disabled",!1):a.find("#palleon-undo").prop("disabled",!0),n.length?a.find("#palleon-redo").prop("disabled",!1):a.find("#palleon-redo").prop("disabled",!0);var i=JSON.parse(e(this).parent().find("script").html());a.find(".palleon-modal").hide(),F(i.backgroundImage.src,function(e){i.backgroundImage.src=e,V(i),a.find("#palleon-canvas-loader").hide()})}),a.find("#palleon-clear-history").on("click",function(){window.confirm(palleonParams.question1)&&(a.find("#palleon-history-list li").remove(),a.find("#palleon-history").prop("disabled",!0),a.find("#palleon-undo").prop("disabled",!0),a.find("#palleon-redo").prop("disabled",!0),a.find(".palleon-modal").hide())}),v.on("palleon:history",function(e){ei(en(e.type)+" "+e.text)});var el=!1;function eo(){a.find("#palleon-layers li").length?(a.find("#palleon-no-layer").hide(),a.find("#palleon-layer-delete-wrap").css("visibility","visible")):(a.find("#palleon-no-layer").show(),a.find("#palleon-layer-delete-wrap").css("visibility","hidden"))}function er(t){if(a.find("#palleon-layers li").removeClass("active"),t.length>=2)for(var n,i,l,o,r=0;r<t.length;r++)a.find("#palleon-layers #"+t[r].id).addClass("active");else{void 0!==(t=t[0])&&t.objectType?("textbox"==t.objectType?(a.find("#palleon-text-settings").show(),n=t,a.find("#palleon-text-input").val(n.text),a.find("#palleon-font-family").val(n.fontFamily),a.find("#palleon-font-family").trigger("change"),"none"==n.gradientFill||""==n.gradientFill||void 0===n.gradientFill?(a.find("#palleon-text-gradient").val("none"),a.find("#palleon-text-color").spectrum("set",n.fill)):"vertical"==n.gradientFill?a.find("#palleon-text-gradient").val("vertical"):"horizontal"==n.gradientFill?a.find("#palleon-text-gradient").val("horizontal"):"diagonal"==n.gradientFill&&a.find("#palleon-text-gradient").val("diagonal"),("vertical"==n.gradientFill||"horizontal"==n.gradientFill||"diagonal"==n.gradientFill)&&(4==n.fill.colorStops.length?(a.find("#text-gradient-color-1").spectrum("set",n.fill.colorStops[0].color),a.find("#text-gradient-color-2").spectrum("set",n.fill.colorStops[1].color),a.find("#text-gradient-color-3").spectrum("set",n.fill.colorStops[2].color),a.find("#text-gradient-color-4").spectrum("set",n.fill.colorStops[3].color)):3==n.fill.colorStops.length?(a.find("#text-gradient-color-1").spectrum("set",n.fill.colorStops[0].color),a.find("#text-gradient-color-2").spectrum("set",n.fill.colorStops[1].color),a.find("#text-gradient-color-3").spectrum("set",n.fill.colorStops[2].color),a.find("#text-gradient-color-4").spectrum("set","")):2==n.fill.colorStops.length&&(a.find("#text-gradient-color-1").spectrum("set",n.fill.colorStops[0].color),a.find("#text-gradient-color-2").spectrum("set",n.fill.colorStops[1].color),a.find("#text-gradient-color-3").spectrum("set",""),a.find("#text-gradient-color-4").spectrum("set",""))),a.find("#palleon-text-gradient").trigger("change"),"bold"==n.fontWeight?a.find("#format-bold").addClass("active"):a.find("#format-bold").removeClass("active"),"italic"==n.fontStyle?a.find("#format-italic").addClass("active"):a.find("#format-italic").removeClass("active"),!0==n.underline?a.find("#format-underline").addClass("active"):a.find("#format-underline").removeClass("active"),"left"==n.textAlign&&(a.find(".format-align").removeClass("active"),a.find("#format-align-left").addClass("active")),"right"==n.textAlign&&(a.find(".format-align").removeClass("active"),a.find("#format-align-right").addClass("active")),"center"==n.textAlign&&(a.find(".format-align").removeClass("active"),a.find("#format-align-center").addClass("active")),"justify"==n.textAlign&&(a.find(".format-align").removeClass("active"),a.find("#format-align-justify").addClass("active")),a.find("#palleon-font-size").val(n.fontSize),a.find("#palleon-outline-size").val(n.strokeWidth),a.find("#palleon-line-height").val(n.lineHeight),a.find("#palleon-letter-spacing").val(n.charSpacing),a.find("#palleon-outline-color").spectrum("set",n.stroke),a.find("#palleon-text-background").spectrum("set",n.textBackgroundColor),null==n.shadow?a.find("#palleon-text-shadow").prop("checked",!1):(a.find("#palleon-text-shadow").prop("checked",!0),a.find("#text-shadow-color").spectrum("set",n.shadow.color),a.find("#text-shadow-blur").val(n.shadow.blur),a.find("#text-shadow-offset-x").val(n.shadow.offsetX),a.find("#text-shadow-offset-y").val(n.shadow.offsetY)),a.find("#palleon-text-shadow").trigger("change"),!0==n.flipX?a.find("#text-flip-x").addClass("active"):a.find("#text-flip-x").removeClass("active"),!0==n.flipY?a.find("#text-flip-y").addClass("active"):a.find("#text-flip-y").removeClass("active"),a.find("#text-skew-x").val(n.skewX),a.find("#text-skew-x").parent().parent().find(".slider-label span").html(n.skewX),a.find("#text-skew-y").val(n.skewY),a.find("#text-skew-y").parent().parent().find(".slider-label span").html(n.skewY),a.find("#text-rotate").val(parseInt(n.angle)),a.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(n.angle)),a.find("#palleon-btn-text").hasClass("active")||a.find("#palleon-btn-text").trigger("click"),a.find("#palleon-font-family").trigger("change")):a.find("#palleon-text-settings").hide(),"image"==t.objectType?(a.find("#palleon-image-settings").show(),""==(i=t).filters?a.find("#image-filter").val("none"):a.find("#image-filter").val(i.filters[0].type.toLowerCase()),void 0===i.clipPath?a.find("#palleon-img-mask").val("none"):null==i.clipPath?a.find("#palleon-img-mask").val("none"):void 0===i.clipPath.maskType?a.find("#palleon-img-mask").val("none"):null==i.clipPath.maskType?a.find("#palleon-img-mask").val("none"):a.find("#palleon-img-mask").val(i.clipPath.maskType),a.find("#img-border-radius").val(i.roundedCorders),a.find("#img-border-radius").parent().parent().find(".slider-label span").html(i.roundedCorders),null==i.shadow?a.find("#palleon-image-shadow").prop("checked",!1):(a.find("#palleon-image-shadow").prop("checked",!0),a.find("#image-shadow-color").spectrum("set",i.shadow.color),a.find("#image-shadow-blur").val(i.shadow.blur),a.find("#image-shadow-offset-x").val(i.shadow.offsetX),a.find("#image-shadow-offset-y").val(i.shadow.offsetY)),a.find("#palleon-image-shadow").trigger("change"),a.find("#img-border-width").val(i.strokeWidth),a.find("#img-border-color").spectrum("set",i.stroke),a.find("#img-opacity").val(i.opacity),a.find("#img-opacity").parent().parent().find(".slider-label span").html(i.opacity),a.find("#img-skew-x").val(i.skewX),a.find("#img-skew-x").parent().parent().find(".slider-label span").html(i.skewX),a.find("#img-skew-y").val(i.skewY),a.find("#img-skew-y").parent().parent().find(".slider-label span").html(i.skewY),a.find("#img-rotate").val(parseInt(i.angle)),a.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(i.angle)),a.find("#palleon-btn-image").hasClass("active")||(a.find("#palleon-btn-image").trigger("click"),a.find("#palleon-img-mode").trigger("click"))):a.find("#palleon-image-settings").hide(),"frame"!=t.objectType||a.find("#palleon-btn-frames").hasClass("active")||a.find("#palleon-btn-frames").trigger("click"),"element"==t.objectType?(a.find("#palleon-custom-element-options").show(),a.find("#palleon-custom-element-options-info").hide(),"none"==(l=t).gradientFill||""==l.gradientFill||void 0===l.gradientFill?(a.find("#palleon-element-gradient").val("none"),a.find("#palleon-element-color").spectrum("set",l.fill)):"vertical"==l.gradientFill?a.find("#palleon-element-gradient").val("vertical"):"horizontal"==l.gradientFill?a.find("#palleon-element-gradient").val("horizontal"):"diagonal"==l.gradientFill&&a.find("#palleon-element-gradient").val("diagonal"),("vertical"==l.gradientFill||"horizontal"==l.gradientFill||"diagonal"==l.gradientFill)&&(4==l.fill.colorStops.length?(a.find("#element-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),a.find("#element-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),a.find("#element-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),a.find("#element-gradient-color-4").spectrum("set",l.fill.colorStops[3].color)):3==l.fill.colorStops.length?(a.find("#element-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),a.find("#element-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),a.find("#element-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),a.find("#element-gradient-color-4").spectrum("set","")):2==l.fill.colorStops.length&&(a.find("#element-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),a.find("#element-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),a.find("#element-gradient-color-3").spectrum("set",""),a.find("#element-gradient-color-4").spectrum("set",""))),a.find("#palleon-element-gradient").trigger("change"),a.find("#element-opacity").val(l.opacity),a.find("#element-opacity").parent().parent().find(".slider-label span").html(l.opacity),a.find("#element-skew-x").val(l.skewX),a.find("#element-skew-x").parent().parent().find(".slider-label span").html(l.skewX),a.find("#element-skew-y").val(l.skewY),a.find("#element-skew-y").parent().parent().find(".slider-label span").html(l.skewY),a.find("#element-rotate").val(parseInt(l.angle)),a.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(l.angle)),null==l.shadow?a.find("#palleon-element-shadow").prop("checked",!1):(a.find("#palleon-element-shadow").prop("checked",!0),a.find("#element-shadow-color").spectrum("set",l.shadow.color),a.find("#element-shadow-blur").val(l.shadow.blur),a.find("#element-shadow-offset-x").val(l.shadow.offsetX),a.find("#element-shadow-offset-y").val(l.shadow.offsetY)),a.find("#palleon-element-shadow").trigger("change"),a.find("#palleon-btn-elements").hasClass("active")||a.find("#palleon-btn-elements").trigger("click"),a.find("#palleon-custom-element-open").trigger("click")):(a.find("#palleon-custom-element-options").hide(),a.find("#palleon-custom-element-options-info").show()),"customSVG"==t.objectType?(a.find("#palleon-custom-svg-options").show(),function t(n){if(n._objects){var i=[],l="";e.each(n._objects,function(e,t){-1===i.indexOf(t.get("fill"))&&i.push(t.get("fill"))}),e.each(i,function(e,t){if("string"==typeof t||t instanceof String){var a=e+1;l+='<div class="palleon-control-wrap control-text-color"><label class="palleon-control-label">'+palleonParams.fillColor+" "+a+'</label><div class="palleon-control"><input id="customsvg-color-'+a+'" type="text" data-color="'+t+'" class="customsvg-color palleon-colorpicker disallow-empty" autocomplete="off" value="'+t+'" /></div></div>'}}),a.find("#customsvg-colors").html(l),a.find(".customsvg-color").spectrum({allowEmpty:!1,showInitial:!0,hideAfterPaletteSelect:!0,showAlpha:!0})}a.find("#customsvg-opacity").val(n.opacity),a.find("#customsvg-opacity").parent().parent().find(".slider-label span").html(n.opacity),a.find("#customsvg-skew-x").val(n.skewX),a.find("#customsvg-skew-x").parent().parent().find(".slider-label span").html(n.skewX),a.find("#customsvg-skew-y").val(n.skewY),a.find("#customsvg-skew-y").parent().parent().find(".slider-label span").html(n.skewY),a.find("#customsvg-rotate").val(parseInt(n.angle)),a.find("#customsvg-rotate").parent().parent().find(".slider-label span").html(parseInt(n.angle))}(t),a.find("#palleon-btn-elements").hasClass("active")||a.find("#palleon-btn-elements").trigger("click"),a.find("#palleon-custom-svg-open").trigger("click")):a.find("#palleon-custom-svg-options").hide(),C.includes(t.objectType)?(j.includes(t.objectType)?a.find("#shape-custom-width-wrap").show():a.find("#shape-custom-width-wrap").hide(),a.find("#palleon-shape-settings").show(),o=t,a.find("#palleon-shape-settings-info").hide(),a.find("#shape-outline-width").val(o.strokeWidth),"none"==o.gradientFill||""==o.gradientFill||void 0===o.gradientFill?(a.find("#palleon-shape-gradient").val("none"),a.find("#palleon-shape-color").spectrum("set",o.fill)):"vertical"==o.gradientFill?a.find("#palleon-shape-gradient").val("vertical"):"horizontal"==o.gradientFill?a.find("#palleon-shape-gradient").val("horizontal"):"diagonal"==o.gradientFill&&a.find("#palleon-shape-gradient").val("diagonal"),("vertical"==o.gradientFill||"horizontal"==o.gradientFill||"diagonal"==o.gradientFill)&&(4==o.fill.colorStops.length?(a.find("#shape-gradient-color-1").spectrum("set",o.fill.colorStops[0].color),a.find("#shape-gradient-color-2").spectrum("set",o.fill.colorStops[1].color),a.find("#shape-gradient-color-3").spectrum("set",o.fill.colorStops[2].color),a.find("#shape-gradient-color-4").spectrum("set",o.fill.colorStops[3].color)):3==o.fill.colorStops.length?(a.find("#shape-gradient-color-1").spectrum("set",o.fill.colorStops[0].color),a.find("#shape-gradient-color-2").spectrum("set",o.fill.colorStops[1].color),a.find("#shape-gradient-color-3").spectrum("set",o.fill.colorStops[2].color),a.find("#shape-gradient-color-4").spectrum("set","")):2==o.fill.colorStops.length&&(a.find("#shape-gradient-color-1").spectrum("set",o.fill.colorStops[0].color),a.find("#shape-gradient-color-2").spectrum("set",o.fill.colorStops[1].color),a.find("#shape-gradient-color-3").spectrum("set",""),a.find("#shape-gradient-color-4").spectrum("set",""))),a.find("#palleon-shape-gradient").trigger("change"),a.find("#shape-outline-color").spectrum("set",o.stroke),null==o.shadow?a.find("#palleon-shape-shadow").prop("checked",!1):(a.find("#palleon-shape-shadow").prop("checked",!0),a.find("#shape-shadow-color").spectrum("set",o.shadow.color),a.find("#shape-shadow-blur").val(o.shadow.blur),a.find("#shape-shadow-offset-x").val(o.shadow.offsetX),a.find("#shape-shadow-offset-y").val(o.shadow.offsetY)),a.find("#palleon-shape-shadow").trigger("change"),null==o.strokeDashArray?a.find("#palleon-shape-dashed-outline").prop("checked",!1):Array.isArray(o.strokeDashArray)&&(a.find("#palleon-shape-dashed-outline").prop("checked",!0),a.find("#shape-dashed-outline-width").val(o.strokeDashArray[0]),a.find("#shape-dashed-outline-spacing").val(o.strokeDashArray[1])),a.find("#palleon-shape-dashed-outline").trigger("change"),a.find("#shape-opacity").val(o.opacity),a.find("#shape-opacity").parent().parent().find(".slider-label span").html(o.opacity),a.find("#shape-skew-x").val(o.skewX),a.find("#shape-skew-x").parent().parent().find(".slider-label span").html(o.skewX),a.find("#shape-skew-y").val(o.skewX),a.find("#shape-skew-y").parent().parent().find(".slider-label span").html(o.skewY),a.find("#shape-rotate").val(parseInt(o.angle)),a.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(o.angle)),"square"==o.objectType||"rectangle"==o.objectType?a.find("#palleon-shape-rounded-corners").show():a.find("#palleon-shape-rounded-corners").hide(),void 0!==o.rx?(a.find("#shape-rounded-corners").val(parseInt(o.rx)),a.find("#shape-rounded-corners").parent().parent().find(".slider-label span").html(parseInt(o.rx))):(a.find("#shape-rounded-corners").val(0),a.find("#shape-rounded-corners").parent().parent().find(".slider-label span").html(0)),"printarea"==o.objectType?(a.find("#shape-custom-width").val(o.width),a.find("#shape-custom-height").val(o.height)):(a.find("#shape-custom-width").val(""),a.find("#shape-custom-height").val("")),a.find("#palleon-btn-shapes").hasClass("active")||a.find("#palleon-btn-shapes").trigger("click"),a.find("#palleon-shape-setting-open").trigger("click")):a.find("#palleon-shape-settings").hide(),t.id&&a.find("#palleon-layers #"+t.id).addClass("active")):e.each(t,function(e,t){a.find("#palleon-layers #"+t.id).addClass("active")})}}function es(){fabric.Image.fromURL(d,function(e){v.setBackgroundImage(e,v.renderAll.bind(v),{objectType:"BG",mode:r,top:0,left:0,scaleX:g,scaleY:h,selectable:!1,angle:f,originX:m,originY:u,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})})}function ed(e){var t=p,n=c;if((0==f||180==f||-180==f)&&(t=c,n=p),e)e/=100,v.setZoom(e);else{var i=a.find("#palleon-img-zoom").val(),l=100,o=1,r=0;t<a.find("#palleon-content").width()&&n<a.find("#palleon-content").height()?(v.setZoom(1),a.find("#palleon-img-zoom").val(100)):(t>a.find("#palleon-content").width()&&i>(l=100*(o=(a.find("#palleon-content").width()-60)/t).toFixed(2))&&(v.setZoom(o.toFixed(2)),a.find("#palleon-img-zoom").val(100*o.toFixed(2)),r=o.toFixed(2)),n>a.find("#palleon-content").height()&&i>(l=100*(o=a.find("#palleon-content").height()/n).toFixed(2))&&(0===r||r>o.toFixed(2))&&(v.setZoom(o.toFixed(2)),a.find("#palleon-img-zoom").val(100*o.toFixed(2))))}v.setWidth(t*v.getZoom()),v.setHeight(n*v.getZoom()),!0===v.isDrawingMode&&(a.find("#palleon-erase-btn").hasClass("active")&&a.find("#eraser-width").trigger("input"),a.find("#palleon-draw-btn").hasClass("active")&&a.find("#brush-width").trigger("input"))}v.on("mouse:up",function(e){var t=e.target;if(null!==t){var a=t.objectType;el&&ei(en(a)+" "+palleonParams.moved)}void 0!==v.overlayImage&&null!==v.overlayImage&&v.overlayImage.set("opacity",1)}),v.on("object:moving",function(e){el=!0,void 0!==v.overlayImage&&null!==v.overlayImage&&v.overlayImage.set("opacity",.7);var t=p,a=c;(0==f||180==f||-180==f)&&(t=c,a=p);var n=e.target,i=n.getScaledWidth(),l=n.getScaledHeight();n.isPartiallyOnScreen()&&"clipPath"==n.objectType&&(n.top<0&&n.left<0?(n.top=0,n.left=0,n.lockMovementX=!0,n.lockMovementY=!0):n.top<0&&i+n.left>t?(n.top=0,n.left=t-i,n.lockMovementX=!0,n.lockMovementY=!0):l+n.top>a&&n.left<0?(n.top=a-l,n.left=0,n.lockMovementX=!0,n.lockMovementY=!0):l+n.top>a&&i+n.left>t?(n.top=a-l,n.left=t-i,n.lockMovementX=!0,n.lockMovementY=!0):n.top<0?(n.top=0,n.lockMovementY=!0):n.left<0?(n.left=0,n.lockMovementX=!0):i+n.left>t?(n.left=t-i,n.lockMovementX=!0):l+n.top>a&&(n.top=a-l,n.lockMovementY=!0),n.setCoords())}),v.on("object:scaling",function(e){var t=p,a=c;(0==f||180==f||-180==f)&&(t=c,a=p);var n=e.target,i=n.getScaledWidth(),l=n.getScaledHeight();n.isPartiallyOnScreen()&&"clipPath"==n.objectType&&(i>=t&&(n.set({scaleX:t/n.width}),n.lockScalingX=!0),l>=a&&(n.set({scaleY:a/n.height}),n.lockScalingY=!0),n.top<0&&(n.top=0,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),n.left<0&&(n.left=0,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),i+n.left>t&&(n.left=t-i,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),l+n.top>a&&(n.top=a-l,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()))}),v.on("object:added",function(t){var n=t.target;if("clipPath"!=n.objectType&&"drawing"!=n.objectType&&"watermark"!=n.objectType){if(!0===v.isDrawingMode)n.set("objectType","drawing"),n.set("selectable",!1),n.set("lockMovementX",!0),n.set("lockMovementY",!0),n.set("lockRotation",!0);else{var i,l,o,r,s,d,c=v.getObjects().indexOf(n),p="",f="Object",g="category",h="layer-visible",m="visibility",u="layer-unlocked",b="lock_open";!1==n.visible&&(h="layer-hidden",m="visibility_off"),!1==n.selectable&&(u="layer-locked",b="lock"),n.set("id",new Date().getTime()),a.find("#palleon-layers > li").removeClass("active"),"textbox"==n.objectType?(f=n.text,g="title"):"drawing"==n.objectType?(f=palleonParams.freeDrawing,g="brush"):"frame"==n.objectType?(f=palleonParams.frame,g="wallpaper"):"image"==n.objectType?(f=palleonParams.image,g="image"):"circle"==n.objectType?f=palleonParams.circle:"square"==n.objectType?f=palleonParams.square:"rectangle"==n.objectType?f=palleonParams.rectangle:"triangle"==n.objectType?f=palleonParams.triangle:"ellipse"==n.objectType?f=palleonParams.ellipse:"trapezoid"==n.objectType?f=palleonParams.trapezoid:"pentagon"==n.objectType?f=palleonParams.pentagon:"octagon"==n.objectType?f=palleonParams.octagon:"emerald"==n.objectType?f=palleonParams.emerald:"diamond"==n.objectType?f=palleonParams.diamond:"parallelogram"==n.objectType?f=palleonParams.parallelogram:"star"==n.objectType?f=palleonParams.star:"customShape"==n.objectType?f=palleonParams.customShape:"element"==n.objectType?(f=palleonParams.element,g="star"):"customSVG"==n.objectType?f=palleonParams.customSvg:"app"==n.objectType&&(f=palleonParams.app,g="apps"),"layerName"in n&&(f=n.layerName),p='<li id="'+n.id+'" data-type="'+n.objectType+'" class="layer-'+n.objectType+' active" data-sort="'+c+'"><span class="material-icons">'+g+'</span><input class="layer-name" autocomplete="off" value="'+f+'" /><span class="material-icons layer-settings">settings</span><div class="layer-icons"><a class="material-icons lock-layer '+u+'" title="'+palleonParams.lockunlock+'">'+b+'</a><a class="material-icons text-success duplicate-layer" title="'+palleonParams.duplicate+'">content_copy</a><a class="material-icons layer-visibility '+h+'" title="'+palleonParams.showhide+'">'+m+'</a><a class="material-icons text-danger delete-layer" title="'+palleonParams.delete+'">clear</a></div></li>',a.find("#palleon-layers").prepend(p),o=n.id,(r=a.find("#palleon-layers #"+o)).find("a.delete-layer").on("click",function(e){e.preventDefault(),v.fire("palleon:history",{type:r.data("type"),text:palleonParams.removed}),v.getObjects().filter(e=>e.id==o).forEach(e=>v.remove(e)),r.remove(),v.requestRenderAll(),a.find("#palleon-layers").sortable("refresh"),eo()}),s=n.id,(d=a.find("#palleon-layers #"+s)).find("a.duplicate-layer").on("click",function(e){e.preventDefault(),v.getObjects().filter(e=>e.id==s).forEach(e=>e.clone(function(t){t.set("id",new Date().getTime()),t.set("objectType",e.objectType),v.add(t),v.setActiveObject(t)})),v.requestRenderAll(),a.find("#palleon-layers").sortable("refresh"),v.fire("palleon:history",{type:d.data("type"),text:palleonParams.added})}),function t(n){a.find("#palleon-layers #"+n).find("a.layer-visibility").on("click",function(t){t.preventDefault();var a=v.getObjects();e(this).hasClass("layer-visible")?(e(this).removeClass("layer-visible"),e(this).addClass("layer-hidden"),e(this).html("visibility_off"),a.filter(e=>e.id==n).forEach(e=>e.set("visible",!1))):e(this).hasClass("layer-hidden")&&(e(this).removeClass("layer-hidden"),e(this).addClass("layer-visible"),e(this).html("visibility"),a.filter(e=>e.id==n).forEach(e=>e.set("visible",!0))),v.requestRenderAll()})}(n.id),function t(n){a.find("#palleon-layers #"+n).find("a.lock-layer").on("click",function(t){t.preventDefault();var a=v.getActiveObject();e(this).hasClass("layer-unlocked")?(e(this).removeClass("layer-unlocked"),e(this).addClass("layer-locked"),e(this).html("lock"),a.set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,selectable:!1})):e(this).hasClass("layer-locked")&&(e(this).removeClass("layer-locked"),e(this).addClass("layer-unlocked"),e(this).html("lock_open"),a.set({lockMovementX:!1,lockMovementY:!1,lockRotation:!1,selectable:!0})),v.requestRenderAll()})}(n.id),function t(n){a.find("#palleon-layers #"+n).on("click",function(t){var n=v.getObjects(),i=e(this).attr("id");n.filter(e=>e.id==i).forEach(e=>v.setActiveObject(e)),a.find("#palleon-layers > li").removeClass("active"),e(this).addClass("active"),v.requestRenderAll()})}(n.id),function t(n){a.find("#palleon-layers #"+n).find(".layer-name").on("change",function(t){var a=v.getObjects(),n=e(this).parent("li").attr("id");a.filter(e=>e.id==n).forEach(t=>t.set({layerName:e(this).val()}))})}(n.id),a.find("#palleon-layers").sortable("refresh"),eo(),(i=n).controls.deleteControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:14,cursorStyle:"pointer",mouseUpHandler:z,render:X,cornerSize:24}),(l=n).controls.cloneControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:-14,cursorStyle:"pointer",mouseUpHandler:W,render:B,cornerSize:24})}}}),v.on("object:modified",function(e){var t=e.target;"textbox"==t.objectType&&t.id&&(a.find("#palleon-layers #"+t.id+" .layer-name").html(t.text),a.find("#text-rotate").val(parseInt(v.getActiveObject().angle)),a.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(v.getActiveObject().angle))),"image"==t.objectType&&t.id&&(a.find("#img-rotate").val(parseInt(v.getActiveObject().angle)),a.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(v.getActiveObject().angle))),"element"==t.objectType&&t.id&&(a.find("#element-rotate").val(parseInt(v.getActiveObject().angle)),a.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(v.getActiveObject().angle))),"customSVG"==t.objectType&&t.id&&(a.find("#customsvg-rotate").val(parseInt(v.getActiveObject().angle)),a.find("#customsvg-rotate").parent().parent().find(".slider-label span").html(parseInt(v.getActiveObject().angle))),C.includes(t.objectType)&&t.id&&(a.find("#shape-rotate").val(parseInt(v.getActiveObject().angle)),a.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(v.getActiveObject().angle))),"clipPath"==t.objectType&&(t.lockScalingX=!1,t.lockScalingY=!1,t.lockMovementX=!1,t.lockMovementY=!1)}),v.on("erasing:end",function(){ei('<span class="material-icons">brush</span>'+palleonParams.erased)}),a.find(".palleon-horizontal-center").on("click",function(){var e=v.getActiveObject();e.set("originX","center"),e.set("left",em()[0]/2),v.requestRenderAll()}),a.find(".palleon-vertical-center").on("click",function(){var e=v.getActiveObject();e.set("originY","center"),e.set("top",em()[1]/2),v.requestRenderAll()}),v.on("selection:created",function(e){er(e.selected)}),v.on("selection:updated",function(e){er(e.selected)}),v.on("selection:cleared",function(){a.find("#palleon-text-settings").hide(),a.find("#palleon-image-settings").hide(),a.find("#palleon-shape-settings").hide(),a.find("#palleon-custom-element-options").hide(),a.find("#palleon-custom-element-options-info").show(),a.find("#palleon-shape-settings-info").show(),a.find("#palleon-custom-svg-options").hide(),a.find("#palleon-layers > li").removeClass("active")}),a.find("#palleon-layers").sortable({placeholder:"layer-placeholder",axis:"y",update:function(t,a){var n=v.getObjects();e("#palleon-layers li").each(function(t,a){e(this).attr("data-sort",t+1),n.filter(e=>e.id==a.id).forEach(e=>e.moveTo(-(t+1)))}),v.requestRenderAll()},create:function(e,t){eo()}}).disableSelection(),a.find("#palleon-layers").on("click",".layer-settings",function(){var t=e(this).next();e(this).hasClass("active")?(e(this).removeClass("active"),t.hide()):(a.find("#palleon-layers .layer-icons").hide(),a.find("#palleon-layers .layer-settings").removeClass("active"),e(this).addClass("active"),t.show())}),a.find("#palleon-layer-delete").on("click",function(){if(window.confirm(palleonParams.question2)){var e=a.find("#palleon-layer-select").val(),t=v.getObjects();"all"==e?(t.forEach(e=>v.remove(e)),a.find("#palleon-layers > li").remove()):(t.filter(t=>t.objectType==e).forEach(e=>v.remove(e)),a.find("#palleon-layers > li.layer-"+e).remove()),v.requestRenderAll(),a.find("#palleon-layers").sortable("refresh"),eo()}}),a.find("#palleon-img-drag").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),a.find("#palleon-canvas-overlay").hide(),a.find("#palleon-canvas-wrap").draggable("disable")):(e(this).addClass("active"),a.find("#palleon-canvas-overlay").show(),a.find("#palleon-canvas-wrap").draggable("enable"))}),a.find(".palleon-counter input.palleon-form-field").on("input",function(){var t=parseInt(e(this).val());ed(t)});var ec=function(e){a.find("#palleon-resize-width").val(Math.round(e.width)),a.find("#palleon-resize-height").val(Math.round(e.height)),a.find("#palleon-img-width").html(Math.round(e.width)),a.find("#palleon-img-height").html(Math.round(e.height)),a.find("#palleon-crop-width").val(Math.round(e.width/2)),a.find("#palleon-crop-height").val(Math.round(e.height/2)),a.find("#palleon-resize-width").data("size",Math.round(e.width)),a.find("#palleon-resize-height").data("size",Math.round(e.height)),"image"==r&&(a.find("#palleon-crop-width").data("max",Math.round(e.width)),a.find("#palleon-crop-height").data("max",Math.round(e.height))),a.find("#palleon-resize-width").trigger("sizeChanged"),a.find("#palleon-resize-height").trigger("sizeChanged")};function ep(){var e=v.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!1)),v.backgroundColor="transparent";var t=R(v.toDataURL({format:"png",enableRetinaScaling:!1}));d=URL.createObjectURL(t),a.find("#palleon-canvas-img").attr("src",d),v.backgroundColor=a.find("#custom-image-background").val(),e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!0))}function ef(){var e=v.getObjects();y.moveTo(9999),v.setActiveObject(y),a.find("#palleon-crop-btns").removeClass("disabled"),a.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","none"),a.find(".palleon-icon-panel-content ul.palleon-accordion > li.accordion-crop").css("pointer-events","auto"),e.filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType).forEach(e=>e.set("selectable",!1))}function eg(e){0==f||180==f||-180==f?(v.setDimensions({width:p,height:c}),g=v.height/s.width,h=v.width/s.height):(v.setDimensions({width:c,height:p}),g=v.width/s.width,h=v.height/s.height),"right"==e?0==f?(f=90,m="left",u="bottom"):90==f?(f=180,m="right",u="bottom"):180==f?(f=270,m="right",u="top"):270==f?(f=0,m="left",u="top"):-90==f?(f=0,m="left",u="top"):-180==f?(f=-90,m="right",u="top"):-270==f&&(f=-180,m="right",u="bottom"):"left"==e&&(0==f?(f=-90,m="right",u="top"):-90==f?(f=-180,m="right",u="bottom"):-180==f?(f=-270,m="left",u="bottom"):-270==f?(f=0,m="left",u="top"):90==f?(f=0,m="left",u="top"):180==f?(f=90,m="left",u="bottom"):270==f&&(f=180,m="right",u="bottom")),v.backgroundImage.set({scaleX:g,scaleY:h,angle:f,originX:m,originY:u});var t=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:v.height,height:v.width,gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});v.add(t),v.discardActiveObject();var a=new fabric.ActiveSelection(v.getObjects(),{canvas:v});v.setActiveObject(a);var n=v.getActiveObject();"right"==e?n.set({angle:90,originX:"left",originY:"bottom"}):"left"==e&&n.set({angle:-90,originX:"right",originY:"top"}),v.remove(t),v.discardActiveObject(),ec(v),ed(),v.requestRenderAll(),v.fire("palleon:history",{type:"BG",text:palleonParams.rotated})}function eh(e){var t=v.getActiveObject();t.set("gradientFill",a.find("#palleon-"+e+"-gradient").val());var n="";if(""==a.find("#"+e+"-gradient-color-3").val()&&""==a.find("#"+e+"-gradient-color-4").val()?n=[{offset:0,color:a.find("#"+e+"-gradient-color-1").val()},{offset:1,color:a.find("#"+e+"-gradient-color-2").val()}]:""!=a.find("#"+e+"-gradient-color-3").val()&&""==a.find("#"+e+"-gradient-color-4").val()?n=[{offset:0,color:a.find("#"+e+"-gradient-color-1").val()},{offset:.5,color:a.find("#"+e+"-gradient-color-2").val()},{offset:1,color:a.find("#"+e+"-gradient-color-3").val()}]:""!=a.find("#"+e+"-gradient-color-1").val()&&""!=a.find("#"+e+"-gradient-color-2").val()&&""!=a.find("#"+e+"-gradient-color-3").val()&&""!=a.find("#"+e+"-gradient-color-4").val()&&(n=[{offset:0,color:a.find("#"+e+"-gradient-color-1").val()},{offset:.25,color:a.find("#"+e+"-gradient-color-2").val()},{offset:.75,color:a.find("#"+e+"-gradient-color-3").val()},{offset:1,color:a.find("#"+e+"-gradient-color-4").val()}]),"vertical"==a.find("#palleon-"+e+"-gradient").val()){if(a.find("#"+e+"-gradient-settings").show(),a.find("#"+e+"-fill-color").hide(),t.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:n})),t._objects)for(var i=0;i<t._objects.length;i++)""!=t._objects[i].fill&&t._objects[i].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:n})})}else if("horizontal"==a.find("#palleon-"+e+"-gradient").val()){if(a.find("#"+e+"-gradient-settings").show(),a.find("#"+e+"-fill-color").hide(),t.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:n})),t._objects)for(var i=0;i<t._objects.length;i++)""!=t._objects[i].fill&&t._objects[i].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:n})})}else if("diagonal"==a.find("#palleon-"+e+"-gradient").val()){if(a.find("#"+e+"-gradient-settings").show(),a.find("#"+e+"-fill-color").hide(),t.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:1},colorStops:n})),t._objects)for(var i=0;i<t._objects.length;i++)""!=t._objects[i].fill&&t._objects[i].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:1},colorStops:n})})}else if(a.find("#"+e+"-gradient-settings").hide(),a.find("#"+e+"-fill-color").show(),t.set("fill",a.find("#palleon-"+e+"-color").val()),t._objects)for(var i=0;i<t._objects.length;i++)""!=t._objects[i].fill&&t._objects[i].set("fill",a.find("#palleon-"+e+"-color").val());v.requestRenderAll()}function em(){var e=v.backgroundImage.getScaledHeight(),t=v.backgroundImage.getScaledWidth();return(0==f||180==f||-180==f)&&(e=v.backgroundImage.getScaledWidth(),t=v.backgroundImage.getScaledHeight()),[e,t]}a.find("#palleon-crop-style").on("change",function(){if(""!=e(this).val()&&e(this).select2("enable",!1),"freeform"==e(this).val())(y=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:c/2,height:p/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1})},v.add(y),ef();else if("custom"==e(this).val()){a.find(".crop-custom").css("display","flex");var t=parseInt(a.find("#palleon-crop-width").val()),n=parseInt(a.find("#palleon-crop-height").val());(y=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:t,height:n,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})},v.add(y),ef()}else if("square"==e(this).val()){var i=p/2;c>=p&&(i=c/2),(y=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:i,height:i,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},v.add(y),ef()}else"original"==e(this).val()?((y=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:c/2,height:p/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},v.add(y),ef()):(v.getObjects().filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType&&"drawing"!=e.objectType).forEach(e=>e.set("selectable",!0)),a.find(".crop-custom").css("display","none"),a.find("#palleon-crop-btns").addClass("disabled"),a.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","auto"))}),a.find("#palleon-crop-cancel").on("click",function(){a.find("#palleon-crop-btns").addClass("disabled"),a.find("#palleon-crop-style").select2("enable"),a.find("#palleon-crop-style").val(""),a.find("#palleon-crop-style").trigger("change"),v.remove(""),v.remove(y)}),a.find("#palleon-crop-apply").on("click",function(){if(window.confirm(palleonParams.question3)){a.find("#palleon-crop-btns").addClass("disabled"),a.find("#palleon-crop-style").select2("enable"),a.find("#palleon-crop-style").val(""),a.find("#palleon-crop-style").trigger("change"),v.setZoom(1),a.find("#palleon-img-zoom").val(100);var e=y.getBoundingRect();v.setWidth(e.width-1),v.setHeight(e.height-1),v.backgroundImage.set({top:-e.top,left:-e.left}),v.remove(""),v.remove(y),ep(),a.find("#palleon-canvas-img-wrap").imagesLoaded(function(){c=v.width,p=v.height,f=0,m="left",u="top",g=1,h=1,es(),ec(v),ed(),v.requestRenderAll(),setTimeout(function(){v.fire("palleon:history",{type:"BG",text:palleonParams.cropped})},500)})}}),a.find("#palleon-crop-width").bind("input paste",function(){if(a.find("#palleon-crop-lock").hasClass("active")){var t=e(this).data("max"),n=a.find("#palleon-crop-height").data("max");a.find("#palleon-crop-height").val(Math.round(this.value/(t/n)))}y.set("width",parseInt(e(this).val())),y.set("height",parseInt(a.find("#palleon-crop-height").val())),v.requestRenderAll()}),a.find("#palleon-crop-height").bind("input paste",function(){if(a.find("#palleon-crop-lock").hasClass("active")){var t=e(this).data("max"),n=a.find("#palleon-crop-width").data("max");a.find("#palleon-crop-width").val(Math.round(this.value/(t/n)))}y.set("height",parseInt(e(this).val())),y.set("width",parseInt(a.find("#palleon-crop-width").val())),v.requestRenderAll()}),a.find("#palleon-resize-apply").on("click",function(){var e,t,n,i;window.confirm(palleonParams.question4)&&(e=parseInt(a.find("#palleon-resize-width").val()),t=parseInt(a.find("#palleon-resize-height").val()),c=e,p=t,v.setZoom(1),a.find("#palleon-img-zoom").val(100),v.setWidth(e),v.setHeight(t),0==f||180==f||-180==f?(g=v.width/a.find("#palleon-canvas-img")[0].width,h=v.height/a.find("#palleon-canvas-img")[0].height):(g=v.height/a.find("#palleon-canvas-img")[0].width,h=v.width/a.find("#palleon-canvas-img")[0].height),v.backgroundImage.set({scaleX:g,scaleY:h}),v.discardActiveObject(),n=new fabric.ActiveSelection(v.getObjects(),{canvas:v}),v.setActiveObject(n),v.requestRenderAll(),(i=v.getActiveObject()).set({top:i.top*h,left:i.left*g,scaleX:g,scaleY:h}),ep(),a.find("#palleon-canvas-img-wrap").imagesLoaded(function(){v.discardActiveObject(),c=v.width,p=v.height,f=0,m="left",u="top",g=1,h=1,es(),ec(v),ed(),v.requestRenderAll(),setTimeout(function(){v.fire("palleon:history",{type:"BG",text:palleonParams.resized})},500)}))}),a.find("#palleon-resize-width").bind("input paste",function(){if(a.find("#palleon-resize-lock").hasClass("active")){var t=e(this).data("size"),n=a.find("#palleon-resize-height").data("size");a.find("#palleon-resize-height").val(Math.round(this.value/(t/n)))}}),a.find("#palleon-resize-height").bind("input paste",function(){if(a.find("#palleon-resize-lock").hasClass("active")){var t=e(this).data("size"),n=a.find("#palleon-resize-width").data("size");a.find("#palleon-resize-width").val(Math.round(this.value/(t/n)))}}),a.find("#palleon-rotate-right").on("click",function(){eg("right")}),a.find("#palleon-rotate-left").on("click",function(){eg("left")}),a.find("#palleon-flip-horizontal").on("click",function(){v.backgroundImage.toggle("flipX");var e=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:em()[0],height:em()[1],gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});v.add(e),v.discardActiveObject();var t=new fabric.ActiveSelection(v.getObjects(),{canvas:v});v.setActiveObject(t);var a=v.getActiveObject();0==f||180==f||-180==f?a.toggle("flipX"):a.toggle("flipY"),v.remove(e),v.discardActiveObject(),v.requestRenderAll(),v.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),a.find("#palleon-flip-vertical").on("click",function(){v.backgroundImage.toggle("flipY");var e=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:em()[0],height:em()[1],gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});v.add(e),v.discardActiveObject();var t=new fabric.ActiveSelection(v.getObjects(),{canvas:v});v.setActiveObject(t);var a=v.getActiveObject();0==f||180==f||-180==f?a.toggle("flipY"):a.toggle("flipX"),v.remove(e),v.discardActiveObject(),v.requestRenderAll(),v.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),a.find("#palleon-brightness").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Brightness):(a.find("#brightness").val(0),a.find("#brightness").parent().parent().find(".slider-label span").html(0),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Brightness"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#brightness").on("input",function(){v.backgroundImage.filters.filter(e=>"Brightness"==e.type).forEach(e=>e.brightness=parseFloat(this.value)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#brightness").on("change",function(e){e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-contrast").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Contrast):(a.find("#contrast").val(0),a.find("#contrast").parent().parent().find(".slider-label span").html(0),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Contrast"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#contrast").on("input",function(){v.backgroundImage.filters.filter(e=>"Contrast"==e.type).forEach(e=>e.contrast=parseFloat(this.value)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#contrast").on("change",function(e){e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-saturation").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Saturation):(a.find("#saturation").val(0),a.find("#saturation").parent().parent().find(".slider-label span").html(0),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Saturation"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#saturation").on("input",function(){v.backgroundImage.filters.filter(e=>"Saturation"==e.type).forEach(e=>e.saturation=parseFloat(this.value)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#saturation").on("change",function(e){e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-hue").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.HueRotation):(a.find("#hue").val(0),a.find("#hue").parent().parent().find(".slider-label span").html(0),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"HueRotation"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#hue").on("input",function(){v.backgroundImage.filters.filter(e=>"HueRotation"==e.type).forEach(e=>e.rotation=parseFloat(this.value)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#hue").on("change",function(e){e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-img-mask").on("change",function(t){var n=e(this).find(":selected").val();"custom"==n?a.find("#palleon-img-radius-settings").removeClass("d-none"):(a.find("#palleon-img-radius-settings").addClass("d-none"),a.find("#img-border-radius").val("0"),a.find("#img-border-radius").parent().parent().find("label span").html("0"));var i=v.getActiveObject(),l=null,o=-(i.width/2),r=-(i.width/2),s=i.width/2;if(i.width>i.height&&(o=-(i.height/2),r=-(i.height/2),s=i.height/2),i.clipPath=null,v.requestRenderAll(),"circle"==n)l=new fabric.Circle({maskType:n,radius:s,left:o,top:r});else if("triangle"==n)l=new fabric.Triangle({maskType:n,width:2*s,height:2*s,left:o,top:r});else if("triangleDown"==n)l=new fabric.Triangle({maskType:n,width:2*s,height:2*s,flipY:!0,left:o,top:r});else if("triangleRight"==n)l=new fabric.Triangle({maskType:n,width:2*s,height:2*s,left:o,top:r,originX:"left",originY:"bottom",angle:90});else if("triangleLeft"==n)l=new fabric.Triangle({maskType:n,width:2*s,height:2*s,left:o,top:r,originX:"right",originY:"top",angle:-90});else if("pentagon"==n){var d=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}else if("pentagonDown"==n){var d=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,flipY:!0,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}else if("pentagonLeft"==n){var d=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,originX:"right",originY:"top",angle:-90,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}else if("pentagonRight"==n){var d=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,originX:"left",originY:"bottom",angle:90,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}else if("octagon"==n){var d=[{x:34.2,y:87.4},{x:12.3,y:65.5},{x:12.3,y:34.5},{x:34.2,y:12.6},{x:65.2,y:12.6},{x:87.1,y:34.5},{x:87.1,y:65.5},{x:65.2,y:87.4}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}else if("star"==n){var d=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}else if("starReverse"==n){var d=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}];(l=new fabric.Polygon(d,{maskType:n,width:2*s,height:2*s,flipY:!0,left:o,top:r})).scaleToWidth(i.width),i.width>i.height&&l.scaleToHeight(i.height)}setTimeout(function(){i.clipPath=l,v.requestRenderAll(),ei(en("image")+" "+palleonParams.mask+" "+palleonParams.added)},100)}),a.find("#image-filter").on("change",function(t){var a=e(this).find(":selected").val(),n=v.getActiveObject();"grayscale"==a?n.filters[0]=new fabric.Image.filters.Grayscale:"sepia"==a?n.filters[0]=new fabric.Image.filters.Sepia:"blackwhite"==a?n.filters[0]=new fabric.Image.filters.BlackWhite:"brownie"==a?n.filters[0]=new fabric.Image.filters.Brownie:"vintage"==a?n.filters[0]=new fabric.Image.filters.Vintage:"kodachrome"==a?n.filters[0]=new fabric.Image.filters.Kodachrome:"technicolor"==a?n.filters[0]=new fabric.Image.filters.Technicolor:"polaroid"==a?n.filters[0]=new fabric.Image.filters.Polaroid:"shift"==a?n.filters[0]=new fabric.Image.filters.Shift:"invert"==a?n.filters[0]=new fabric.Image.filters.Invert:n.filters=[],n.applyFilters(),v.requestRenderAll()}),a.find("#palleon-filters input[type=checkbox]").on("change",function(t){e(this).is(":checked")?"grayscale"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Grayscale):"sepia"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Sepia):"blackwhite"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.BlackWhite):"brownie"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Brownie):"vintage"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Vintage):"kodachrome"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Kodachrome):"technicolor"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Technicolor):"polaroid"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Polaroid):"shift"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Shift):"invert"==e(this).attr("id")?v.backgroundImage.filters.push(new fabric.Image.filters.Invert):"sharpen"==e(this).attr("id")?(a.find("#emboss").prop("checked",!1),a.find("#sobelX").prop("checked",!1),a.find("#sobelY").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type),v.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))):"emboss"==e(this).attr("id")?(a.find("#sharpen").prop("checked",!1),a.find("#sobelX").prop("checked",!1),a.find("#sobelY").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type),v.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))):"sobelX"==e(this).attr("id")?(a.find("#emboss").prop("checked",!1),a.find("#sharpen").prop("checked",!1),a.find("#sobelY").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type),v.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,0,1,-2,0,2,-1,0,1]}))):"sobelY"==e(this).attr("id")&&(a.find("#emboss").prop("checked",!1),a.find("#sharpen").prop("checked",!1),a.find("#sobelX").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type),v.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,-2,-1,0,0,0,1,2,1]}))):"grayscale"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Grayscale"!=e.type):"sepia"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Sepia"!=e.type):"blackwhite"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"BlackWhite"!=e.type):"brownie"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Brownie"!=e.type):"vintage"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Vintage"!=e.type):"kodachrome"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Kodachrome"!=e.type):"technicolor"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Technicolor"!=e.type):"polaroid"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Polaroid"!=e.type):"shift"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Shift"!=e.type):"invert"==e(this).attr("id")?v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Invert"!=e.type):"sharpen"==e(this).attr("id")?(a.find("#emboss").prop("checked",!1),a.find("#sobelX").prop("checked",!1),a.find("#sobelY").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"emboss"==e(this).attr("id")?(a.find("#sharpen").prop("checked",!1),a.find("#sobelX").prop("checked",!1),a.find("#sobelY").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelX"==e(this).attr("id")?(a.find("#emboss").prop("checked",!1),a.find("#sharpen").prop("checked",!1),a.find("#sobelY").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelY"==e(this).attr("id")&&(a.find("#emboss").prop("checked",!1),a.find("#sharpen").prop("checked",!1),a.find("#sobelX").prop("checked",!1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Convolute"!=e.type)),v.backgroundImage.applyFilters(),v.requestRenderAll(),t.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-gamma").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Gamma):(a.find("#gamma-red").val(1),a.find("#gamma-red").parent().parent().find(".slider-label span").html(1),a.find("#gamma-green").val(1),a.find("#gamma-green").parent().parent().find(".slider-label span").html(1),a.find("#gamma-blue").val(1),a.find("#gamma-blue").parent().parent().find(".slider-label span").html(1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Gamma"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#palleon-gamma-settings input").on("input",function(){var t=parseFloat(e("#gamma-red").val()),a=parseFloat(e("#gamma-green").val()),n=parseFloat(e("#gamma-blue").val()),i=[t,a,n];v.backgroundImage.filters.filter(e=>"Gamma"==e.type).forEach(e=>e.gamma=i),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#palleon-gamma-settings input").on("change",function(e){e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-blur").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Blur):(a.find("#blur").val(0),a.find("#blur").parent().parent().find(".slider-label span").html(0),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Blur"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#blur").on("change",function(e){v.backgroundImage.filters.filter(e=>"Blur"==e.type).forEach(e=>e.blur=parseFloat(this.value)),v.backgroundImage.applyFilters(),v.requestRenderAll(),e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-noise").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Noise):(a.find("#noise").val(0),a.find("#noise").parent().parent().find(".slider-label span").html(0),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Noise"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#noise").on("input",function(){v.backgroundImage.filters.filter(e=>"Noise"==e.type).forEach(e=>e.noise=parseInt(this.value,10)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#noise").on("change",function(e){e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-pixelate").on("change",function(){e(this).is(":checked")?v.backgroundImage.filters.push(new fabric.Image.filters.Pixelate):(a.find("#pixelate").val(1),a.find("#pixelate").parent().parent().find(".slider-label span").html(1),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Pixelate"!=e.type),v.backgroundImage.applyFilters()),v.requestRenderAll()}),a.find("#pixelate").on("change",function(e){v.backgroundImage.filters.filter(e=>"Pixelate"==e.type).forEach(e=>e.blocksize=parseInt(this.value,10)),v.backgroundImage.applyFilters(),v.requestRenderAll(),e.originalEvent&&ei(palleonParams.bg+" "+palleonParams.edited)}),a.find("#palleon-blend-color").on("change",function(){if(e(this).is(":checked")){var t=a.find("#blend-color-mode").val(),n=a.find("#blend-color-color").val(),i=parseFloat(a.find("#blend-color-alpha").val());v.backgroundImage.filters.push(new fabric.Image.filters.BlendColor),v.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=t,e=>e.color=n,e=>e.alpha=parseFloat(i))}else a.find("#blend-color-mode").val("add"),a.find("#blend-color-color").spectrum("set","#ffffff"),a.find("#blend-color-alpha").val(.5),a.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"BlendColor"!=e.type);v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#blend-color-mode").on("change",function(){v.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=this.value),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#blend-color-color").on("change",function(){v.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.color=this.value),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#blend-color-alpha").on("input",function(){v.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.alpha=parseFloat(this.value)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#palleon-duotone-color").on("change",function(){e(this).is(":checked")?(k=new fabric.Image.filters.Composed({subFilters:[new fabric.Image.filters.Grayscale({mode:"luminosity"}),new fabric.Image.filters.BlendColor({color:a.find("#duotone-light-color").val()}),new fabric.Image.filters.BlendColor({color:a.find("#duotone-dark-color").val(),mode:"lighten"})]}),v.backgroundImage.filters.push(k)):(a.find("#duotone-light-color").spectrum("set","green"),a.find("#duotone-dark-color").spectrum("set","blue"),v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Composed"!=e.type)),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#duotone-light-color").on("change",function(){v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Composed"!=e.type),v.backgroundImage.filters.push(k),k.subFilters[1].color=e(this).val(),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#duotone-dark-color").on("change",function(){v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"Composed"!=e.type),v.backgroundImage.filters.push(k),k.subFilters[2].color=e(this).val(),v.backgroundImage.applyFilters(),v.requestRenderAll()}),a.find("#palleon-swap-apply").on("click",function(){var t=new fabric.Image.filters.SwapColor({colorSource:a.find("#color-source").val(),colorDestination:a.find("#color-destination").val()});v.backgroundImage.filters.push(t),v.backgroundImage.applyFilters(),v.requestRenderAll(),e(this).prop("disabled",!0),a.find("#palleon-swap-remove").prop("disabled",!1)}),a.find("#palleon-swap-remove").on("click",function(){v.backgroundImage.filters=v.backgroundImage.filters.filter(e=>"SwapColor"!=e.type),v.backgroundImage.applyFilters(),v.requestRenderAll(),e(this).prop("disabled",!0),a.find("#palleon-swap-apply").prop("disabled",!1)}),a.find("#palleon-swap-colors").on("change",function(){e(this).is(":checked")||a.find("#palleon-swap-remove").trigger("click")}),e.each(["text","image","shape","element"],function(t,n){a.find("#palleon-"+n+"-shadow").on("change",function(){var t=new fabric.Shadow({color:a.find("#"+n+"-shadow-color").val(),blur:a.find("#"+n+"-shadow-blur").val(),offsetX:a.find("#"+n+"-shadow-offset-x").val(),offsetY:a.find("#"+n+"-shadow-offset-y").val()});e(this).is(":checked")?v.getActiveObject().shadow=t:v.getActiveObject().shadow=null,v.requestRenderAll()}),a.find("#"+n+"-shadow-color").bind("change",function(){v.getActiveObject().shadow.color=e(this).val(),v.requestRenderAll()}),a.find("#"+n+"-shadow-settings input[type=number]").bind("input paste keyup keydown",function(){var t=e(this).val();e(this).attr("id")==n+"-shadow-blur"?v.getActiveObject().shadow.blur=parseInt(t):e(this).attr("id")==n+"-shadow-offset-x"?v.getActiveObject().shadow.offsetX=parseInt(t):e(this).attr("id")==n+"-shadow-offset-y"&&(v.getActiveObject().shadow.offsetY=parseInt(t)),v.requestRenderAll()})}),e.each(["text","shape","element"],function(e,t){a.find("#palleon-"+t+"-gradient").on("change",function(){eh(t)}),a.find("#"+t+"-gradient-color-1").on("change",function(){eh(t)}),a.find("#"+t+"-gradient-color-2").on("change",function(){eh(t)}),a.find("#"+t+"-gradient-color-3").on("change",function(){eh(t)}),a.find("#"+t+"-gradient-color-4").on("change",function(){eh(t)})}),a.find("#palleon-add-text").on("click",function(){var e=new fabric.Textbox(palleonParams.textbox,{objectType:"textbox",gradientFill:"none",fontSize:i.fontSize,fontFamily:i.fontFamily,fontWeight:i.fontWeight,fontStyle:i.fontStyle,lineHeight:i.lineHeight,fill:i.fill,stroke:i.stroke,strokeWidth:i.strokeWidth,textBackgroundColor:i.textBackgroundColor,textAlign:i.textAlign,width:em()[0]/2,top:em()[1]/2,left:em()[0]/2,originX:"center",originY:"center"});v.add(e),v.setActiveObject(e),v.fire("palleon:history",{type:"textbox",text:palleonParams.added})}),a.find("#palleon-text-input").bind("input paste",function(){v.getActiveObject().set("text",e(this).val()),a.find("#palleon-layers #"+v.getActiveObject().id+" .layer-name").html(v.getActiveObject().text),v.requestRenderAll()}),a.find("#palleon-text-input").bind("focusout",function(){v.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),a.find("#palleon-font-family").on("change",function(){for(var t=e(this).val(),a="yes",n=0;n<A.length;n++)if(A[n][1]==t){a="no";break}if("yes"==a){WebFont.load({google:{families:[t+":regular,bold",t+":italic,regular,bold"]}});var i=new FontFaceObserver(t,{weight:"normal",style:"normal"}),l=new FontFaceObserver(t,{weight:"bold",style:"normal"}),o=new FontFaceObserver(t,{weight:"normal",style:"italic"}),r=new FontFaceObserver(t,{weight:"bold",style:"italic"});Promise.all([i.load(null,5e3),l.load(null,5e3),o.load(null,5e3),r.load(null,5e3)]).then(function(){v.getActiveObject().set("fontFamily",t),v.requestRenderAll()}).catch(function(e){console.log(e)})}else v.getActiveObject().set("fontFamily",t),v.requestRenderAll()});var eu=[],ev=0;function eb(t){var a=t.element;return e(a).data("icon")?e('<div class="select2-item"><span class="material-icons">'+e(a).data("icon")+"</span>"+t.text+"</div>"):e(a).data("font")?e('<div class="select2-item" style="font-family:'+e(a).data("font")+'">'+t.text+"</div>"):e('<div class="select2-item">'+t.text+"</div>")}a.find("#palleon-font-family").on("select2:open",function(){a.find("#select2-palleon-font-family-results").scroll(function(){e(this).find("li:last-child").find("ul li").each(function(){var t=e(this);t.is(":in-viewport( 0, #select2-palleon-font-family-results)")&&!eu.includes(t.attr("id"))&&(WebFont.load({google:{families:[t.find(".select2-item").html()]},inactive:function(){WebFont.load({custom:{families:[t.find(".select2-item").html()],urls:["https://fonts.googleapis.com/css?family="+t.find(".select2-item").html()+"&text=abc"]},active:function(){console.log("active")}})}}),eu.push(t.attr("id")))})}),a.on("keypress",".select2-search .select2-search__field",function(e){window.clearTimeout(ev),ev=setTimeout(function(){a.find("#select2-palleon-font-family-results").trigger("scroll")},500)})}),a.find("#palleon-text-format-btns > .palleon-btn").on("click",function(){if("format-uppercase"==e(this).attr("id")){var t=a.find("#palleon-text-input").val();t=t===t.toUpperCase()?t.toLowerCase():t.toUpperCase(),a.find("#palleon-text-input").val(t),a.find("#palleon-text-input").trigger("input")}e(this).hasClass("active")?("format-bold"==e(this).attr("id")&&(v.getActiveObject().set("fontWeight","normal"),e(this).removeClass("active")),"format-italic"==e(this).attr("id")&&(v.getActiveObject().set("fontStyle","normal"),e(this).removeClass("active")),"format-underlined"==e(this).attr("id")&&(v.getActiveObject().set("underline",!1),e(this).removeClass("active"))):("format-bold"==e(this).attr("id")&&v.getActiveObject().set("fontWeight","bold"),"format-italic"==e(this).attr("id")&&v.getActiveObject().set("fontStyle","italic"),"format-underlined"==e(this).attr("id")&&v.getActiveObject().set("underline",!0),"format-align-left"==e(this).attr("id")&&v.getActiveObject().set("textAlign","left"),"format-align-right"==e(this).attr("id")&&v.getActiveObject().set("textAlign","right"),"format-align-center"==e(this).attr("id")&&v.getActiveObject().set("textAlign","center"),"format-align-justify"==e(this).attr("id")&&v.getActiveObject().set("textAlign","justify"),a.find(".format-align").removeClass("active"),"format-uppercase"!=e(this).attr("id")&&e(this).addClass("active")),v.requestRenderAll(),v.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),a.find("#palleon-text-settings input[type=number]").bind("input paste keyup keydown",function(){var t=e(this).val();"palleon-font-size"==e(this).attr("id")?v.getActiveObject().set("fontSize",parseInt(t)):"palleon-outline-size"==e(this).attr("id")?v.getActiveObject().set("strokeWidth",parseInt(t)):"palleon-line-height"==e(this).attr("id")?v.getActiveObject().set("lineHeight",parseFloat(t)):"palleon-letter-spacing"==e(this).attr("id")&&v.getActiveObject().set("charSpacing",parseInt(t)),v.requestRenderAll()}),a.find("#palleon-text-settings input[type=number]").bind("input",function(){window.clearTimeout(_),_=setTimeout(function(){v.fire("palleon:history",{type:"textbox",text:palleonParams.edited})},500)}),a.find("#palleon-text-settings .palleon-colorpicker").bind("change",function(){var t=e(this).val();"palleon-text-color"==e(this).attr("id")?v.getActiveObject().set("fill",t):"palleon-outline-color"==e(this).attr("id")?v.getActiveObject().set("stroke",t):"palleon-text-background"==e(this).attr("id")&&v.getActiveObject().set("textBackgroundColor",t),v.requestRenderAll(),v.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),a.find("#palleon-text-flip-btns > .palleon-btn").on("click",function(){e(this).hasClass("active")?("text-flip-x"==e(this).attr("id")?v.getActiveObject().set("flipX",!1):"text-flip-y"==e(this).attr("id")&&v.getActiveObject().set("flipY",!1),e(this).removeClass("active")):("text-flip-x"==e(this).attr("id")?v.getActiveObject().set("flipX",!0):"text-flip-y"==e(this).attr("id")&&v.getActiveObject().set("flipY",!0),e(this).addClass("active")),v.requestRenderAll(),v.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),a.find("#palleon-text-settings input[type=range]").bind("input click",function(){var t=e(this).val();"text-skew-x"==e(this).attr("id")?v.getActiveObject().set("skewX",parseInt(t)):"text-skew-y"==e(this).attr("id")?v.getActiveObject().set("skewY",parseInt(t)):"text-rotate"==e(this).attr("id")?v.getActiveObject().set("angle",parseInt(t)):"text-opacity"==e(this).attr("id")&&v.getActiveObject().set("opacity",parseFloat(t)),v.requestRenderAll()}),a.find("#palleon-text-settings input[type=range]").bind("change",function(){v.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),a.find("#palleon-img-upload").on("change",function(e){var t=new FileReader;t.onload=function(e){var t=new Image;F(e.target.result,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t);e.set({objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:em()[1]/2,left:em()[0]/2,originX:"center",originY:"center"}),v.add(e),e.scaleToWidth(em()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(em()[1]/2),v.setActiveObject(e),v.requestRenderAll()}})},t.readAsDataURL(e.target.files[0]),v.fire("palleon:history",{type:"image",text:palleonParams.added})}),a.find("#palleon-overlay-img-upload").on("change",function(t){if(""!=e(this).val()){a.find("#palleon-canvas-loader").css("display","flex");var n=new FileReader;n.onload=function(e){fabric.Image.fromURL(e.target.result,function(t){t.set({scaleX:em()[0]/t.width,scaleY:em()[1]/t.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),v.setOverlayImage(t,v.renderAll.bind(v)),a.find("#palleon-overlay-wrap").show(),a.find("#palleon-overlay-preview").attr("src",e.target.result),setTimeout(function(){a.find("#palleon-canvas-loader").hide()},500)})},n.readAsDataURL(t.target.files[0]),v.fire("palleon:history",{type:"image",text:palleonParams.added})}}),a.find("#palleon-overlay-delete").on("click",function(){void 0!==v.overlayImage&&null!==v.overlayImage&&(v.overlayImage=null,a.find("#palleon-overlay-wrap").hide(),a.find("#palleon-overlay-preview").attr("src",""),v.requestRenderAll())}),a.find("#img-flip-horizontal").on("click",function(){v.getActiveObject().toggle("flipX"),v.requestRenderAll(),v.fire("palleon:history",{type:"image",text:palleonParams.edited})}),a.find("#img-flip-vertical").on("click",function(){v.getActiveObject().toggle("flipY"),v.requestRenderAll(),v.fire("palleon:history",{type:"image",text:palleonParams.edited})});var ey=(e,t)=>new fabric.Rect({width:e.width,height:e.height,rx:t/e.scaleX,ry:t/e.scaleY,left:-e.width/2,top:-e.height/2});a.find("#img-border-radius").on("input",function(){v.getActiveObject().set("clipPath",ey(v.getActiveObject(),parseInt(e(this).val()))),v.getActiveObject().set("roundedCorders",parseInt(e(this).val())),v.requestRenderAll()}),a.find("#img-border-radius").bind("change",function(){v.fire("palleon:history",{type:"image",text:palleonParams.edited})}),a.find("#img-border-color").bind("change",function(){v.getActiveObject().set("stroke",e(this).val()),v.requestRenderAll(),v.fire("palleon:history",{type:"image",text:palleonParams.edited})}),a.find("#palleon-image-settings input[type=number]").on("input paste",function(){var t=parseInt(e(this).val());"img-border-width"==e(this).attr("id")&&v.getActiveObject().set("strokeWidth",t),v.requestRenderAll()}),a.find("#palleon-image-settings input[type=number]").bind("input",function(){window.clearTimeout(_),_=setTimeout(function(){v.fire("palleon:history",{type:"image",text:palleonParams.edited})},500)}),a.find("#palleon-image-settings input[type=range]").bind("input click",function(){var t=e(this).val();"img-skew-x"==e(this).attr("id")?v.getActiveObject().set("skewX",parseInt(t)):"img-skew-y"==e(this).attr("id")?v.getActiveObject().set("skewY",parseInt(t)):"img-rotate"==e(this).attr("id")?v.getActiveObject().set("angle",parseInt(t)):"img-opacity"==e(this).attr("id")&&v.getActiveObject().set("opacity",parseFloat(t)),v.requestRenderAll()}),a.find("#palleon-image-settings input[type=range]").bind("change",function(){v.fire("palleon:history",{type:"image",text:palleonParams.edited})}),a.find("#shape-rounded-corners").on("input",function(){var t=parseInt(e(this).val()),a=v.getActiveObject();("square"==a.objectType||"rectangle"==a.objectType)&&(a.set("rx",t),a.set("ry",t)),v.requestRenderAll()}),a.on("click","#palleon-shapes-grid > div",function(){var t=e(this).attr("data-id");"printarea"==t&&(v.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>v.remove(e)),a.find("#palleon-layers li").remove());var n=em()[1]/2,i=em()[0]/2,l=v.getObjects().filter(e=>"printarea"==e.objectType)[0];if(l&&(n=l.top,i=l.left),"customShape"==t){var o=new XMLSerializer().serializeToString(e(this)[0]);fabric.loadSVGFromString(o,function(e,t){var a=fabric.util.groupSVGElements(e,t);a.set("originX","center"),a.set("originY","center"),a.set("left",i),a.set("top",n),a.set("objectType","customShape"),a.set("gradientFill","none"),a.set("stroke","#000"),a.set("strokeWidth",0),a.set("fill","#fff"),v.add(a),l?(a.scaleToWidth(.5*l.width*v.getZoom()),a.isContainedWithinObject(l)||a.scaleToHeight(.5*l.height*v.getZoom())):(a.scaleToWidth(em()[0]/8),a.isPartiallyOnScreen()&&a.scaleToHeight(em()[1]/8)),v.setActiveObject(a),v.requestRenderAll(),v.fire("palleon:history",{type:"customShape",text:palleonParams.added})},function(){},{crossOrigin:"anonymous"})}else{var r="",s="";"circle"==t?(r=new fabric.Circle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"circle",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"ellipse"==t?r=new fabric.Ellipse({rx:75,ry:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"ellipse",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"}):"square"==t?(r=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"square",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"rectangle"==t?r=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"rectangle",width:200,height:150,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"}):"triangle"==t?r=new fabric.Triangle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"triangle",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"}):"trapezoid"==t?(s=[{x:-100,y:-50},{x:100,y:-50},{x:150,y:50},{x:-150,y:50}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"trapezoid",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"pentagon"==t?(s=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"pentagon",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"octagon"==t?(s=[{x:34.2,y:87.4},{x:12.3,y:65.5},{x:12.3,y:34.5},{x:34.2,y:12.6},{x:65.2,y:12.6},{x:87.1,y:34.5},{x:87.1,y:65.5},{x:65.2,y:87.4}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"octagon",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"emerald"==t?(s=[{x:850,y:75},{x:958,y:137.5},{x:958,y:262.5},{x:850,y:325},{x:742,y:262.5},{x:742,y:137.5}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"emerald",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"star"==t?(s=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"star",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"diamond"==t?(s=[{x:69.445,y:125},{x:125,y:28.774},{x:180.556,y:125},{x:125,y:221.227}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"diamond",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"parallelogram"==t?(s=[{x:15,y:10},{x:55,y:10},{x:45,y:20},{x:5,y:20}],r=new fabric.Polygon(s,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"parallelogram",width:100,height:100,gradientFill:"none",top:n,left:i,originX:"center",originY:"center"})):"printarea"==t&&((r=new fabric.Rect({radius:50,fill:"",stroke:"#4affff",strokeWidth:3,strokeDashArray:[10,5],objectType:"printarea",width:c/2,height:p/2,gradientFill:"none",top:n,left:i,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})}),v.add(r),l?(r.scaleToWidth(.5*l.width*v.getZoom()),r.isContainedWithinObject(l)||r.scaleToHeight(.5*l.height*v.getZoom())):"printarea"!=r.objectType&&(r.scaleToWidth(em()[0]/6),r.isPartiallyOnScreen()&&r.scaleToHeight(em()[1]/6)),v.setActiveObject(r),v.requestRenderAll(),v.fire("palleon:history",{type:t,text:palleonParams.added})}}),a.find("#palleon-shape-loadmore").on("click",function(){var t=e(this);t.html(palleonParams.loading),t.prop("disabled",!0),e.getJSON(i.baseURL+"json/shapes.json",function(n){e.each(n,function(e,t){var n='<div class="palleon-shape" data-id="customShape" title="'+palleonParams.customShape+'">'+t+"</div>";a.find("#palleon-shapes-grid").append(n)}),t.remove()})}),a.find("#palleon-shape-settings .palleon-colorpicker").bind("change",function(){var t=e(this).val();"palleon-shape-color"==e(this).attr("id")?v.getActiveObject().set("fill",t):"shape-outline-color"==e(this).attr("id")&&v.getActiveObject().set("stroke",t),v.requestRenderAll(),v.fire("palleon:history",{type:v.getActiveObject().objectType,text:palleonParams.edited})}),a.find("#palleon-shape-settings input[type=range]").bind("input click",function(){var t=e(this).val();"shape-skew-x"==e(this).attr("id")?v.getActiveObject().set("skewX",parseInt(t)):"shape-skew-y"==e(this).attr("id")?v.getActiveObject().set("skewY",parseInt(t)):"shape-rotate"==e(this).attr("id")?v.getActiveObject().set("angle",parseInt(t)):"shape-opacity"==e(this).attr("id")&&v.getActiveObject().set("opacity",parseFloat(t)),v.requestRenderAll()}),a.find("#palleon-shape-settings input[type=range]").bind("change",function(){v.fire("palleon:history",{type:v.getActiveObject().objectType,text:palleonParams.edited})}),a.find("#palleon-shape-settings input[type=number]").bind("input paste",function(){var t=parseInt(e(this).val());"shape-outline-width"==e(this).attr("id")?v.getActiveObject().set("strokeWidth",t):"shape-custom-width"==e(this).attr("id")?(v.getActiveObject().set("width",t),v.getActiveObject().set("scaleX",1)):"shape-custom-height"==e(this).attr("id")&&(v.getActiveObject().set("height",t),v.getActiveObject().set("scaleY",1)),v.requestRenderAll()}),a.find("#palleon-shape-settings input[type=number]").bind("input",function(){window.clearTimeout(_),_=setTimeout(function(){v.fire("palleon:history",{type:v.getActiveObject().objectType,text:palleonParams.edited})},500)}),a.find("#shape-custom-width").bind("input paste",function(){if(a.find("#palleon-shape-ratio-lock").hasClass("active")){var t=parseInt(e(this).val()),n=parseInt(a.find("#palleon-shape-ratio-w").val()),i=parseInt(a.find("#palleon-shape-ratio-h").val()),l=t*i/n;a.find("#shape-custom-height").val(Math.round(l)),v.getActiveObject().set("height",l),v.getActiveObject().set("scaleY",1)}}),a.find("#shape-custom-height").bind("input paste",function(){if(a.find("#palleon-shape-ratio-lock").hasClass("active")){var t=e(this).val(),n=parseInt(a.find("#palleon-shape-ratio-w").val()),i=parseInt(a.find("#palleon-shape-ratio-h").val()),l=t*n/i;a.find("#shape-custom-width").val(Math.round(l)),v.getActiveObject().set("width",l),v.getActiveObject().set("scaleX",1)}});var e$=function(e){a.find("#palleon-frames-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()};function ew(t){var a=v.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){var n=a.angle,i=a.width,l=a.height,o=em()[0],r=em()[1];(0==n||180==n||-180==n)&&(o=em()[1],r=em()[0]),"right"==t?0==n?n=90:90==n?n=180:180==n?n=270:270==n?n=0:-90==n?n=0:-180==n?n=-90:-270==n&&(n=-180):"left"==t&&(0==n?n=-90:-90==n?n=-180:-180==n?n=-270:-270==n?n=0:90==n?n=0:180==n?n=90:270==n&&(n=180)),a.set("left",em()[0]/2),a.set("top",em()[1]/2),a.set("scaleX",o/i),a.set("scaleY",r/l),a.set("angle",n)}),v.requestRenderAll(),v.fire("palleon:history",{type:"frame",text:palleonParams.edited})}a.find("#palleon-frame-search").on("keyup input",function(){a.find("#palleon-noframes").hide();var t=e(this).val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(a.find("#palleon-frames-wrap li").show(),a.find("#palleon-frame-search-icon").html("search"),a.find("#palleon-frame-search-icon").removeClass("cancel")):(a.find("#palleon-frame-search-icon").html("clear"),a.find("#palleon-frame-search-icon").addClass("cancel"),e$(t),0===a.find("#palleon-frames-wrap li:visible").length&&a.find("#palleon-noframes").show())}),a.find("#palleon-frame-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),a.find("#palleon-frame-search").val(""),a.find("#palleon-frames-wrap li").show(),a.find("#palleon-noframes").hide())}),a.find(".palleon-frames-grid").on("click",".palleon-frame img",function(){a.find("#palleon-canvas-loader").css("display","flex");var t=e(this).parent().parent(),n=t.data("elsource");a.find(".palleon-frames-grid .palleon-frame").removeClass("active"),t.addClass("active"),fabric.loadSVGFromURL(n,function(e,t){var n=fabric.util.groupSVGElements(e,t),i=n.width,l=n.height;n.set("originX","center"),n.set("originY","center"),n.set("left",em()[0]/2),n.set("top",em()[1]/2),n.set("scaleX",(em()[0]+2)/i),n.set("scaleY",(em()[1]+2)/l),n.set("objectType","frame"),v.add(n),v.setActiveObject(n),v.requestRenderAll(),a.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),v.fire("palleon:history",{type:"frame",text:palleonParams.added})}),a.find("#palleon-frame-color").bind("change",function(){var t=e(this).val(),a=v.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){if(""!=a.fill&&a.set("fill",t),a._objects)for(var n=0;n<a._objects.length;n++)""!=a._objects[n].fill&&a._objects[n].set({fill:t})}),v.requestRenderAll(),v.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),a.find("#palleon-rotate-right-frame").on("click",function(){ew("right")}),a.find("#palleon-rotate-left-frame").on("click",function(){ew("left")}),a.find("#palleon-flip-horizontal-frame").on("click",function(){var t=v.getObjects().filter(e=>"frame"==e.objectType);e.each(t,function(e,t){t.toggle("flipX")}),v.requestRenderAll(),v.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),a.find("#palleon-flip-vertical-frame").on("click",function(){var t=v.getObjects().filter(e=>"frame"==e.objectType);e.each(t,function(e,t){t.toggle("flipY")}),v.requestRenderAll(),v.fire("palleon:history",{type:"frame",text:palleonParams.edited})});var ek=function(e){a.find("#palleon-elements-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()};a.find("#palleon-element-search").on("keyup input",function(){a.find("#palleon-noelements").hide();var t=e(this).val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(a.find("#palleon-elements-wrap li").show(),a.find("#palleon-element-search-icon").html("search"),a.find("#palleon-element-search-icon").removeClass("cancel")):(a.find("#palleon-element-search-icon").html("clear"),a.find("#palleon-element-search-icon").addClass("cancel"),ek(t),0===a.find("#palleon-elements-wrap li:visible").length&&a.find("#palleon-noelements").show())}),a.find("#palleon-element-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),a.find("#palleon-element-search").val(""),a.find("#palleon-elements-wrap li").show(),a.find("#palleon-noelements").hide())}),a.find(".palleon-elements-grid").on("click",".palleon-element > *:first-child",function(){var t=e(this).parent(),n=t.data("elsource");if("palleon-icons-grid"==t.parent().attr("id")){var i=a.find("#palleon-icon-style").val();n=t.data("elsource")+"/"+i+"/24px.svg",console.log(n)}var l=t.data("loader");"yes"==l&&a.find("#palleon-canvas-loader").css("display","flex"),a.find(".palleon-elements-grid .palleon-element").removeClass("active"),t.addClass("active"),fabric.loadSVGFromURL(n,function(e,t){var n=fabric.util.groupSVGElements(e,t);n.set("originX","center"),n.set("originY","center"),n.set("left",em()[0]/2),n.set("top",em()[1]/2),J(n)?(n.set("objectType","element"),v.fire("palleon:history",{type:"element",text:palleonParams.added})):(n.set("objectType","customSVG"),v.fire("palleon:history",{type:"customSVG",text:palleonParams.added})),n.set("gradientFill","none"),v.add(n),n.scaleToWidth(em()[0]/8),n.isPartiallyOnScreen()&&n.scaleToHeight(em()[1]/8),v.setActiveObject(n),v.requestRenderAll(),"yes"==l&&a.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),v.fire("palleon:history",{type:"element",text:palleonParams.added})}),a.find("#palleon-element-upload").on("change",function(e){var t=new FileReader,a="";t.onload=function(e){a=t.result,fabric.loadSVGFromURL(a,function(e,t){var a=fabric.util.groupSVGElements(e,t);a.set("originX","center"),a.set("originY","center"),a.set("left",em()[0]/2),a.set("top",em()[1]/2),J(a)?(a.set("objectType","element"),v.fire("palleon:history",{type:"element",text:palleonParams.added})):(a.set("objectType","customSVG"),v.fire("palleon:history",{type:"customSVG",text:palleonParams.added})),a.scaleToWidth(em()[0]/2),a.scaleToHeight(em()[1]/2),v.add(a),v.setActiveObject(a),v.requestRenderAll()},function(){},{crossOrigin:"anonymous"})},t.readAsDataURL(this.files[0])}),a.find("#palleon-element-color").bind("change",function(){var t=e(this).val(),a=v.getActiveObject();if(""!=a.fill&&a.set("fill",t),a._objects)for(var n=0;n<a._objects.length;n++)""!=a._objects[n].fill&&a._objects[n].set({fill:t});v.requestRenderAll(),v.fire("palleon:history",{type:"element",text:palleonParams.edited})}),a.find("#element-flip-horizontal").on("click",function(){v.getActiveObject().toggle("flipX"),v.requestRenderAll(),v.fire("palleon:history",{type:"element",text:palleonParams.edited})}),a.find("#element-flip-vertical").on("click",function(){v.getActiveObject().toggle("flipY"),v.requestRenderAll(),v.fire("palleon:history",{type:"element",text:palleonParams.edited})}),a.find("#palleon-custom-element-options input[type=range]").bind("input click",function(){var t=e(this).val();"element-skew-x"==e(this).attr("id")?v.getActiveObject().set("skewX",parseInt(t)):"element-skew-y"==e(this).attr("id")?v.getActiveObject().set("skewY",parseInt(t)):"element-rotate"==e(this).attr("id")?v.getActiveObject().set("angle",parseInt(t)):"element-opacity"==e(this).attr("id")&&v.getActiveObject().set("opacity",parseFloat(t)),v.requestRenderAll()}),a.find("#palleon-custom-element-options input[type=range]").bind("change",function(){v.fire("palleon:history",{type:"element",text:palleonParams.edited})}),a.find("#palleon-customsvg-upload").on("change",".customsvg-color",function(){var t=e(this).val(),a=e(this).attr("data-color"),n=v.getActiveObject();if(n._objects){for(var i=0;i<n._objects.length;i++)n._objects[i].fill==a&&n._objects[i].set({fill:t});e(this).attr("data-color",t)}v.requestRenderAll(),v.fire("palleon:history",{type:"element",text:palleonParams.edited})}),a.find("#customsvg-flip-horizontal").on("click",function(){v.getActiveObject().toggle("flipX"),v.requestRenderAll(),v.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})}),a.find("#customsvg-flip-vertical").on("click",function(){v.getActiveObject().toggle("flipY"),v.requestRenderAll(),v.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})}),a.find("#palleon-custom-svg-options input[type=range]").bind("input click",function(){var t=e(this).val();"customsvg-skew-x"==e(this).attr("id")?v.getActiveObject().set("skewX",parseInt(t)):"customsvg-skew-y"==e(this).attr("id")?v.getActiveObject().set("skewY",parseInt(t)):"customsvg-rotate"==e(this).attr("id")?v.getActiveObject().set("angle",parseInt(t)):"customsvg-opacity"==e(this).attr("id")&&v.getActiveObject().set("opacity",parseFloat(t)),v.requestRenderAll()}),a.find("#palleon-custom-svg-options input[type=range]").bind("change",function(){v.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})});var e_=function(e){a.find("#palleon-icons-grid .palleon-element").css("display","none").filter('[title*="'+e+'"]').css("display","flex")};a.find("#palleon-icon-search").on("keyup input",function(){a.find("#palleon-noicons").hide();var t=e(this).val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(a.find("#palleon-icons-grid .palleon-element").css("display","flex"),a.find("#palleon-icon-search-icon").html("search"),a.find("#palleon-icon-search-icon").removeClass("cancel")):(a.find("#palleon-icon-search-icon").html("clear"),a.find("#palleon-icon-search-icon").addClass("cancel"),e_(t),0===a.find("#palleon-icons-grid .palleon-element:visible").length&&a.find("#palleon-noicons").show())}),a.find("#palleon-icon-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),a.find("#palleon-icon-search").val(""),a.find("#palleon-icons-grid .palleon-element").css("display","flex"),a.find("#palleon-noicons").hide())}),a.find("#palleon-apps-menu > .palleon-apps-menu-item").on("click",function(){var t=e(this).attr("data-id");a.find("#palleon-apps-content > div").addClass("d-none"),a.find(t).removeClass("d-none"),a.find("#palleon-apps-menu").hide()}),a.find(".palleon-close-app").on("click",function(){a.find("#palleon-apps-content > div").addClass("d-none"),a.find("#palleon-apps-menu").show()}),a.find(".palleon-app-download").on("click",function(){var t=e(this).attr("data-id"),n=a.find("#palleon-"+t+"-preview")[0],i=new XMLSerializer().serializeToString(n),l=document.createElement("a"),o=new Blob([i],{type:"text/plain"});l.href=URL.createObjectURL(o),l.download=t+".svg",l.click()}),a.find(".palleon-app-download-png").on("click",function(){var t=e(this).attr("data-id"),n=R(a.find("#palleon-"+t+"-preview").find("img").attr("src")),i=URL.createObjectURL(n),l=document.createElement("a");l.download=t+".png",l.href=i,l.click()}),a.find(".palleon-app-select").on("click",function(){var t=e(this),n=e(this).attr("data-id"),i=a.find("#palleon-"+n+"-preview")[0],l=em()[1]/2,o=em()[0]/2,r=v.getObjects().filter(e=>"printarea"==e.objectType)[0];r&&(l=r.top,o=r.left);var s=new XMLSerializer().serializeToString(i);fabric.loadSVGFromString(s,function(e,a){var n=fabric.util.groupSVGElements(e,a);n.set("originX","center"),n.set("originY","center"),n.set("left",o),n.set("top",l),t.hasClass("element")?n.set("objectType","element"):n.set("objectType","customSVG"),n.set("gradientFill","none"),n.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},v.add(n),r?(n.scaleToWidth(.5*r.width*v.getZoom()),n.isContainedWithinObject(r)||n.scaleToHeight(.5*r.height*v.getZoom())):(n.scaleToWidth(em()[0]/8),n.isPartiallyOnScreen()&&n.scaleToHeight(em()[1]/8)),v.setActiveObject(n),v.requestRenderAll()})}),a.find(".palleon-app-select-png").on("click",function(){var t=e(this).attr("data-id"),n=a.find("#palleon-"+t+"-preview").find("img").attr("src"),i=new Image,l=em()[1]/2,o=em()[0]/2,r=v.getObjects().filter(e=>"printarea"==e.objectType)[0];r&&(l=r.top,o=r.left),i.src=n,i.onload=function(){var e=new fabric.Image(i,{objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:l,left:o,originX:"center",originY:"center"});v.add(e),r?(e.scaleToWidth(.8*r.width*v.getZoom()),e.isContainedWithinObject(r)||e.scaleToHeight(.8*r.height*v.getZoom())):(e.scaleToWidth(em()[0]/4),e.isPartiallyOnScreen()&&e.scaleToHeight(em()[1]/4)),v.setActiveObject(e),v.requestRenderAll(),a.find("#palleon-canvas-loader").hide(),v.fire("palleon:history",{type:"image",text:palleonParams.added})}});var ex={},eC="";function ej(e,t,n,i,l){let o=window.trianglify;var r=o({width:e,height:t,cellSize:n,variance:i,xColors:l,yColors:"match",fill:!0}).toCanvas();r=r.toDataURL({format:"png",enableRetinaScaling:!1}),a.find("#palleon-trianglify-preview").html('<img src="'+r+'" />')}function e0(){return kjua({text:a.find("#palleon-qrcode-text").val(),render:"svg",size:300,fill:a.find("#palleon-qrcode-fill").val(),back:a.find("#palleon-qrcode-back").val(),rounded:a.find("#palleon-qrcode-rounded").val(),mode:"label",label:a.find("#palleon-qrcode-label").val(),fontname:"sans",fontcolor:a.find("#palleon-qrcode-label-color").val(),mSize:a.find("#palleon-qrcode-label-size").val(),mPosX:a.find("#palleon-qrcode-label-position-x").val(),mPosY:a.find("#palleon-qrcode-label-position-y").val()})}function eA(){var t=!1,n="";a.find("#palleon-barcode-show-text").is(":checked")&&(t=!0),a.find("#palleon-barcode-text-bold").hasClass("active")&&(n+="bold"),a.find("#palleon-barcode-text-italic").hasClass("active")&&(n+=" italic"),JsBarcode("#palleon-barcode-preview",a.find("#palleon-barcode-text").val(),{format:a.find("#palleon-barcode-format").val(),width:parseInt(a.find("#palleon-barcode-bar-width").val()),height:parseInt(a.find("#palleon-barcode-height").val()),displayValue:t,fontOptions:n,font:a.find("#palleon-barcode-font-family").val(),textAlign:e("#palleon-barcode-text-options").find(".format-align.active").data("align"),textMargin:parseInt(a.find("#palleon-barcode-text-margin").val()),fontSize:parseInt(a.find("#palleon-barcode-font-size").val()),background:a.find("#palleon-barcode-back").val(),lineColor:a.find("#palleon-barcode-line").val(),margin:parseInt(a.find("#palleon-barcode-margin").val()),valid:function(t){t?(e("#palleon-barcode-wrap").show(),e("#palleon-barcode-notice").addClass("d-none"),a.find("#palleon-generate-barcode").prop("disabled",!1)):(e("#palleon-barcode-wrap").hide(),e("#palleon-barcode-notice").removeClass("d-none"),a.find("#palleon-generate-barcode").prop("disabled",!0))}})}function eI(t,n){e("#tm-cursor-1").remove(),a.find("#palleon-canvas-wrap").tmpointer({id:1,native_cursor:"enable",cursorSize:t,cursorColor:n})}function eT(e,t){return e.filter(function(e){return e!=t})}function eO(){if(localStorage.getItem("palleon-user-frames")){var t=JSON.parse(localStorage.getItem("palleon-user-frames")),n=t.length,i="";e.each(t,function(e,t){a.find("[data-frameid='"+t+"']").addClass("favorited"),a.find("[data-frameid='"+t+"']").find(".material-icons").html("star"),i+='<div class="palleon-frame" data-elsource="'+t+'.svg"><div class="palleon-img-wrap" style="min-height: auto;"><img class="lazy" data-src="'+t+'.jpg" src="'+t+'.jpg"></div><div class="frame-favorite"><button type="button" class="palleon-btn-simple star favorited" data-frameid="'+t+'"><span class="material-icons">star</span></button></div></div>'}),a.find("#palleon-frames-favorites").html(i),a.find("#frames-favorites-count").html(n),T.update()}else a.find("#palleon-frames-favorites").html('<div class="notice notice-info"><h6>'+palleonParams.nofavorites+"</h6>"+palleonParams.nofavoritesdesc+"</div>"),a.find("#frames-favorites-count").html("0")}function eS(){if(localStorage.getItem("palleon-user-elements")){var t=JSON.parse(localStorage.getItem("palleon-user-elements")),n=t.length,i="";e.each(t,function(e,t){a.find("[data-elementid='"+t+"']").addClass("favorited"),a.find("[data-elementid='"+t+"']").find(".material-icons").html("star"),i+='<div class="palleon-element" data-elsource="'+t+'.svg" data-loader="no"><img class="lazy" data-src="'+t+'.svg" /><div class="element-favorite"><button type="button" class="palleon-btn-simple star favorited" data-elementid="'+t+'"><span class="material-icons">star</span></button></div></div>'}),a.find("#palleon-elements-favorites").html(i),a.find("#elements-favorites-count").html(n),T.update()}else a.find("#palleon-elements-favorites").html('<div class="notice notice-info"><h6>'+palleonParams.nofavorites+"</h6>"+palleonParams.nofavoritesdesc+"</div>"),a.find("#elements-favorites-count").html("0")}function e3(){if(localStorage.getItem("palleon-user-templates")){var t=JSON.parse(localStorage.getItem("palleon-user-templates")),n="";e.each(t,function(e,t){a.find("[data-templateid='"+t+"']").addClass("favorited"),a.find("[data-templateid='"+t+"']").find(".material-icons").html("star"),n+='<div class="grid-item" data-keyword="" data-category=""><div class="template-favorite"><button type="button" class="palleon-btn-simple star" data-templateid="'+t+'"><span class="material-icons">star</span></button></div><div class="palleon-masonry-item-inner palleon-select-template" data-json="files/templates/json/'+t+'.json"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="files/templates/img/'+t+'.jpg" /></div></div></div>'}),a.find("#templates-favorites").html(n),T.update()}else a.find("#templates-favorites").html('<div class="notice notice-info"><h6>'+palleonParams.nofavorites+"</h6>"+palleonParams.nofavoritesdesc+"</div>")}if(a.find("#palleon-btn-apps").one("click",function(){ex={YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]};var t='<div class="palleon-colorbrewer-item random active" data-id="random"><span class="material-icons">shuffle</span></div>';e.each(ex,function(e,a){t+='<div class="palleon-colorbrewer-item" data-id="'+e+'">';for(var n=0;n<a.length;n++)t+='<div style="background: '+a[n]+';"></div>';t+="</div>"}),a.find("#palleon-colorbrewer").html(t),e.getJSON(i.baseURL+"json/brands.json",function(t){eC=t;for(var n=0;n<t.length;n++)"envato"==t[n].id?a.find("#palleon-brands-list").append(e("<option></option>").attr("value",t[n].id).attr("selected","selected").text(t[n].title)):a.find("#palleon-brands-list").append(e("<option></option>").attr("value",t[n].id).text(t[n].title));a.find("#palleon-brands-list").trigger("change")}),e.getJSON(i.baseURL+"json/crypto.json",function(t){for(var n=0;n<t.length;n++)"BTC"==t[n].symbol?a.find("#palleon-crypto-list").append(e("<option></option>").attr("value",t[n].symbol).attr("selected","selected").text(t[n].name)):a.find("#palleon-crypto-list").append(e("<option></option>").attr("value",t[n].symbol).text(t[n].name));a.find("#palleon-crypto-list").trigger("change")}),e.getJSON(i.baseURL+"json/countries.json",function(t){for(var n=0;n<t.length;n++)a.find("#palleon-flags-list").append(e("<option></option>").attr("value",t[n].code).text(t[n].name));a.find("#palleon-flags-list").trigger("change")})}),a.find("#palleon-apps-menu-trianglify").one("click",function(){ej(1440,900,75,.5,"random")}),a.find(".palleon-colorbrewer-item").on("click",function(){if(e(this).hasClass("active")){if(e(this).hasClass("random")){var t=parseInt(a.find("#palleon-trianglify-width").val()),n=parseInt(a.find("#palleon-trianglify-height").val()),i=a.find("#palleon-trianglify-cell-size").val(),l=a.find("#palleon-trianglify-variance").val();ej(t,n,i,l,"random")}}else{a.find(".palleon-colorbrewer-item").removeClass("active"),e(this).addClass("active");var t=parseInt(a.find("#palleon-trianglify-width").val()),n=parseInt(a.find("#palleon-trianglify-height").val()),i=a.find("#palleon-trianglify-cell-size").val(),l=a.find("#palleon-trianglify-variance").val();ej(t,n,i,l,e(this).attr("data-id"))}}),a.find("#palleon-trianglify-width").on("change",function(){var t,n=parseInt(e(this).val()),i=parseInt(a.find("#palleon-trianglify-height").val()),l=a.find("#palleon-trianglify-cell-size").val();ej(n,i,l,a.find("#palleon-trianglify-variance").val(),a.find(".palleon-colorbrewer-item.active").attr("data-id"))}),a.find("#palleon-trianglify-height").on("change",function(){var t,n=parseInt(e(this).val()),i=parseInt(a.find("#palleon-trianglify-width").val()),l=a.find("#palleon-trianglify-cell-size").val();ej(i,n,l,a.find("#palleon-trianglify-variance").val(),a.find(".palleon-colorbrewer-item.active").attr("data-id"))}),a.find("#palleon-trianglify-cell-size").on("change",function(){var t,n=parseInt(a.find("#palleon-trianglify-height").val()),i=parseInt(a.find("#palleon-trianglify-width").val()),l=e(this).val();ej(i,n,l,a.find("#palleon-trianglify-variance").val(),a.find(".palleon-colorbrewer-item.active").attr("data-id"))}),a.find("#palleon-trianglify-variance").on("change",function(){var t=parseInt(a.find("#palleon-trianglify-height").val()),n=parseInt(a.find("#palleon-trianglify-width").val()),i=a.find("#palleon-trianglify-cell-size").val(),l=e(this).val();ej(n,t,i,l,a.find(".palleon-colorbrewer-item.active").attr("data-id"))}),a.find("#palleon-brands-list").on("change",function(){for(var t=e(this).val(),n=0;n<eC.length;n++)if(eC[n].id==t){var i="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/"+eC[n].id+".svg";e.get(i,function(t){var i=e(t).find("svg");i.removeAttr("xmlns:a"),a.find("#palleon-brands-preview > *").replaceWith(i),a.find("#palleon-brands-preview").html(a.find("#palleon-brands-preview").html().replace(/^.{4}/g,'<svg fill="#'+eC[n].hex+'"'))},"xml");return}}),a.find("#palleon-crypto-list").on("change",function(){var t=e(this).val().toLowerCase(),n=i.baseURL+"files/crypto/"+t+".svg";e.get(n,function(t){var n=e(t).find("svg");n.removeAttr("xmlns:a"),a.find("#palleon-crypto-preview > *").replaceWith(n)},"xml")}),a.find("#palleon-flags-style").on("change",function(){var t=e(this).val(),n=a.find("#palleon-flags-list").val().toLowerCase(),l=i.baseURL+"files/flags/"+t+"/"+n+".svg";e.get(l,function(t){var n=e(t).find("svg");n.removeAttr("xmlns:a"),a.find("#palleon-flags-preview > *").replaceWith(n)},"xml")}),a.find("#palleon-flags-list").on("change",function(){var t=e(this).val().toLowerCase(),n=a.find("#palleon-flags-style").val(),l=i.baseURL+"files/flags/"+n+"/"+t+".svg";e.get(l,function(t){var n=e(t).find("svg");n.removeAttr("xmlns:a"),a.find("#palleon-flags-preview > *").replaceWith(n)},"xml")}),a.find("#palleon-generate-multiavatar").on("click",function(){var e=new Date().getTime(),t=multiavatar(e);a.find("#palleon-multiavatar-name").val(e),a.find("#palleon-multiavatar-preview").html(t)}),a.find("#palleon-apps-menu-multiavatar").on("click",function(){a.find("#palleon-generate-multiavatar").trigger("click")}),a.find("#palleon-multiavatar-name").on("input paste",function(){var t="John Doe";0!==e(this).val().length?t=e(this).val():e(this).val(t);var n=multiavatar(t);a.find("#palleon-multiavatar-preview").html(n)}),a.find("#palleon-generate-qr-code").on("click",function(){var e=kjua({text:a.find("#palleon-qrcode-text").val(),render:"svg",size:300,fill:a.find("#palleon-qrcode-fill").val(),back:a.find("#palleon-qrcode-back").val(),rounded:a.find("#palleon-qrcode-rounded").val(),mode:"label",label:a.find("#palleon-qrcode-label").val(),fontname:"sans",fontcolor:a.find("#palleon-qrcode-label-color").val(),mSize:a.find("#palleon-qrcode-label-size").val(),mPosX:a.find("#palleon-qrcode-label-position-x").val(),mPosY:a.find("#palleon-qrcode-label-position-y").val()}),t=em()[1]/2,n=em()[0]/2,i=v.getObjects().filter(e=>"printarea"==e.objectType)[0];i&&(t=i.top,n=i.left);var l=new XMLSerializer().serializeToString(e);fabric.loadSVGFromString(l,function(e,a){var l=fabric.util.groupSVGElements(e,a);l.set("originX","center"),l.set("originY","center"),l.set("left",n),l.set("top",t),l.set("objectType","app"),l.set("gradientFill","none"),l.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},v.add(l),i?(l.scaleToWidth(.5*i.width*v.getZoom()),l.isContainedWithinObject(i)||l.scaleToHeight(.5*i.height*v.getZoom())):(l.scaleToWidth(em()[0]/8),l.isPartiallyOnScreen()&&l.scaleToHeight(em()[1]/8)),v.setActiveObject(l),v.requestRenderAll()})}),a.find("#palleon-apps-menu-qrcode").one("click",function(){a.find("#qrcode-preview").html(e0())}),a.find('#palleon-qrcode-settings input[type="text"]').on("input",function(){var e=e0();a.find("#qrcode-preview").html(e)}),a.find("#palleon-qrcode-settings .palleon-colorpicker").bind("change",function(){var e=e0();a.find("#qrcode-preview").html(e)}),a.find("#palleon-qrcode-settings input[type=range]").bind("input click",function(){var e=e0();a.find("#qrcode-preview").html(e)}),a.find("#palleon-generate-barcode").on("click",function(){var e=document.getElementById("palleon-barcode-preview"),t=em()[1]/2,a=em()[0]/2,n=v.getObjects().filter(e=>"printarea"==e.objectType)[0];n&&(t=n.top,a=n.left);var i=new XMLSerializer().serializeToString(e);fabric.loadSVGFromString(i,function(e,i){var l=fabric.util.groupSVGElements(e,i);l.set("originX","center"),l.set("originY","center"),l.set("left",a),l.set("top",t),l.set("objectType","app"),l.set("gradientFill","none"),l.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},v.add(l),n?(l.scaleToWidth(.5*n.width*v.getZoom()),l.isContainedWithinObject(n)||l.scaleToHeight(.5*n.height*v.getZoom())):(l.scaleToWidth(em()[0]/4),l.isPartiallyOnScreen()&&l.scaleToHeight(em()[1]/4)),v.setActiveObject(l),v.requestRenderAll()})}),a.find("#palleon-apps-menu-barcode").one("click",function(){a.find("#barcode-preview").html(eA())}),a.find('#palleon-barcode-settings input[type="text"]').on("input",function(){eA()}),a.find("#palleon-barcode-settings .palleon-colorpicker").bind("change",function(){eA()}),a.find("#palleon-barcode-settings input[type=range]").bind("input click",function(){eA()}),a.find("#palleon-barcode-settings .format-style").on("click",function(){e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active"),eA()}),a.find("#palleon-barcode-settings .format-align").on("click",function(){e(this).hasClass("active")||(a.find("#palleon-barcode-settings .format-align").removeClass("active"),e(this).addClass("active")),eA()}),a.find("#palleon-barcode-settings .palleon-select").bind("change",function(){"palleon-barcode-format"==e(this).attr("id")&&a.find("#palleon-barcode-text").val({CODE128:"Example 1234",CODE128A:"EXAMPLE",CODE128B:"Example text",CODE128C:"12345678",EAN13:"1234567890128",EAN8:"12345670",UPC:"123456789999",CODE39:"EXAMPLE TEXT",ITF14:"10012345000017",ITF:"123456",MSI:"123456",MSI10:"123456",MSI11:"123456",MSI1010:"123456",MSI1110:"123456",pharmacode:"1234"}[e(this).val()]),eA()}),a.find("#palleon-barcode-settings .palleon-toggle-checkbox").bind("change",function(){eA()}),a.find("#palleon-draw-btn").on("click",function(){e(this).hasClass("active")?(a.find("#palleon-draw-undo").prop("disabled",!0),a.find("#palleon-draw-undo").removeClass("active"),e("#tm-cursor-1").remove(),a.find("#palleon-draw-settings").hide(),a.find("#palleon-top-bar, #palleon-right-col, #palleon-icon-menu, #palleon-toggle-left, #palleon-toggle-right").css("pointer-events","auto"),e(this).removeClass("active"),v.isDrawingMode=!1,e(this).html('<span class="material-icons">edit</span>'+palleonParams.startDrawing)):(a.find("#palleon-draw-undo").prop("disabled",!1),a.find("#palleon-draw-settings").show(),a.find("#palleon-top-bar, #palleon-right-col, #palleon-icon-menu, #palleon-toggle-left, #palleon-toggle-right").css("pointer-events","none"),e(this).addClass("active"),a.find("#palleon-brush-select").trigger("change"),v.isDrawingMode=!0,e(this).html('<span class="material-icons">close</span>'+palleonParams.stopDrawing))}),a.find("#palleon-brush-select").on("change",function(){var t=e(this).val();if("erase"==t?(e("#palleon-brush-tip").hide(),e("#palleon-eraser-tip").show()):(e("#palleon-brush-tip").show(),e("#palleon-eraser-tip").hide()),"pencil"==t){var n=new fabric.PencilBrush(v);v.freeDrawingBrush=n}else if("circle"==t){var i=new fabric.CircleBrush(v);v.freeDrawingBrush=i}else if("spray"==t){var l=new fabric.SprayBrush(v);v.freeDrawingBrush=l}else if("hline"==t){var o=new fabric.PatternBrush(v);v.freeDrawingBrush=o,o.getPatternSrc=function(){var e=parseInt(a.find("#brush-pattern-width").val()),t=e/2,n=fabric.document.createElement("canvas");n.width=n.height=e;var i=n.getContext("2d");return i.strokeStyle=a.find("#brush-color").val(),i.lineWidth=t,i.beginPath(),i.moveTo(t,0),i.lineTo(t,e),i.closePath(),i.stroke(),n}}else if("vline"==t){var r=new fabric.PatternBrush(v);v.freeDrawingBrush=r,r.getPatternSrc=function(){var e=parseInt(a.find("#brush-pattern-width").val()),t=e/2,n=fabric.document.createElement("canvas");n.width=n.height=e;var i=n.getContext("2d");return i.strokeStyle=a.find("#brush-color").val(),i.lineWidth=t,i.beginPath(),i.moveTo(0,t),i.lineTo(e,t),i.closePath(),i.stroke(),n}}else if("square"==t){var s=new fabric.PatternBrush(v);v.freeDrawingBrush=s,s.getPatternSrc=function(){var e=parseInt(a.find("#brush-pattern-width").val()),t=parseInt(a.find("#brush-pattern-distance").val()),n=fabric.document.createElement("canvas");n.width=n.height=e+t;var i=n.getContext("2d");return i.fillStyle=a.find("#brush-color").val(),i.fillRect(0,0,e,e),n}}else if("erase"==t){var d=new fabric.EraserBrush(v);v.freeDrawingBrush=d}($=v.freeDrawingBrush).getPatternSrc&&($.source=$.getPatternSrc.call($)),$.width=parseInt(a.find("#brush-width").val()),"erase"==t?(a.find("#not-erase-brush").hide(),$.shadow=null,$.color="#E91E63"):(v.freeDrawingBrush.inverted=!1,a.find("#palleon-draw-undo").removeClass("active"),a.find("#not-erase-brush").show(),$.color=a.find("#brush-color").val()),a.find("#palleon-brush-shadow").is(":checked")?$.shadow=w:$.shadow=null,eI($.width*v.getZoom(),$.color),"hline"==t||"vline"==t||"square"==t?a.find("#palleon-brush-pattern-width").css("display","flex"):a.find("#palleon-brush-pattern-width").css("display","none"),"square"==t?a.find("#palleon-brush-pattern-distance").css("display","flex"):a.find("#palleon-brush-pattern-distance").css("display","none")}),a.find("#palleon-brush-shadow").on("change",function(){w=new fabric.Shadow({color:a.find("#brush-shadow-color").val(),blur:a.find("#brush-shadow-width").val(),offsetX:a.find("#brush-shadow-shadow-offset-x").val(),offsetY:a.find("#brush-shadow-shadow-offset-y").val()}),e(this).is(":checked")?$.shadow=w:$.shadow=null}),a.find("#palleon-draw-settings input[type=number]").bind("input paste keyup keydown",function(){"brush-width"==e(this).attr("id")?($.width=parseInt(e(this).val()),eI($.width*v.getZoom(),$.color)):"brush-shadow-shadow-offset-x"==e(this).attr("id")?w.offsetX=parseInt(e(this).val()):"brush-shadow-shadow-offset-y"==e(this).attr("id")?w.offsetY=parseInt(e(this).val()):"brush-shadow-width"==e(this).attr("id")?w.blur=parseInt(e(this).val()):"brush-pattern-width"==e(this).attr("id")?a.find("#palleon-brush-select").trigger("change"):"brush-pattern-distance"==e(this).attr("id")&&a.find("#palleon-brush-select").trigger("change")}),a.find("#palleon-draw-settings .palleon-colorpicker").bind("change",function(){"brush-color"==e(this).attr("id")?($.color=e(this).val(),eI($.width*v.getZoom(),$.color),a.find("#palleon-brush-select").trigger("change")):"brush-shadow-color"==e(this).attr("id")&&(w.color=e(this).val())}),a.find("#palleon-draw-undo").on("click",function(){if("erase"==a.find("#palleon-brush-select").val())v.backgroundImage&&(e(this).hasClass("active")?(e(this).removeClass("active"),v.freeDrawingBrush.inverted=!1):(e(this).addClass("active"),v.freeDrawingBrush.inverted=!0));else{var t=v.getObjects().filter(e=>"drawing"==e.objectType).slice(-1)[0];v.remove(t),v.requestRenderAll()}}),document.onkeydown=function(e){var t=v.getActiveObject();switch(e.keyCode){case 38:t&&(t.top-=1,v.requestRenderAll());break;case 40:t&&(t.top+=1,v.requestRenderAll());break;case 37:t&&(t.left-=1,v.requestRenderAll());break;case 39:t&&(t.left+=1,v.requestRenderAll())}},eO(),a.find(".palleon-frames-grid").on("click",".frame-favorite button.star",function(){var t=e(this),a=t.data("frameid");if(t.hasClass("favorited")){if(localStorage.getItem("palleon-user-frames")){var n=JSON.parse(localStorage.getItem("palleon-user-frames")),i=eT(n,a);0===i.length?localStorage.removeItem("palleon-user-frames"):localStorage.setItem("palleon-user-frames",JSON.stringify(i))}t.removeClass("favorited"),t.find(".material-icons").html("star_border"),toastr.success(palleonParams.unfavorited,palleonParams.success)}else{if(localStorage.getItem("palleon-user-frames")){var n=JSON.parse(localStorage.getItem("palleon-user-frames"));n.push(a),localStorage.setItem("palleon-user-frames",JSON.stringify(n))}else{var l=[];l[0]=a,localStorage.setItem("palleon-user-frames",JSON.stringify(l))}t.addClass("favorited"),t.find(".material-icons").html("star"),toastr.success(palleonParams.favorited,palleonParams.success)}eO()}),eS(),a.find(".palleon-elements-grid").on("click",".element-favorite button.star",function(){var t=e(this),a=t.data("elementid");if(t.hasClass("favorited")){if(localStorage.getItem("palleon-user-elements")){var n=JSON.parse(localStorage.getItem("palleon-user-elements")),i=eT(n,a);0===i.length?localStorage.removeItem("palleon-user-elements"):localStorage.setItem("palleon-user-elements",JSON.stringify(i))}t.removeClass("favorited"),t.find(".material-icons").html("star_border"),toastr.success(palleonParams.unfavorited,palleonParams.success)}else{if(localStorage.getItem("palleon-user-elements")){var n=JSON.parse(localStorage.getItem("palleon-user-elements"));n.push(a),localStorage.setItem("palleon-user-elements",JSON.stringify(n))}else{var l=[];l[0]=a,localStorage.setItem("palleon-user-elements",JSON.stringify(l))}t.addClass("favorited"),t.find(".material-icons").html("star"),toastr.success(palleonParams.favorited,palleonParams.success)}eS()}),e3(),a.find(".template-grid").on("click",".template-favorite button.star",function(){var t=e(this),a=t.data("templateid");if(t.hasClass("favorited")){if(localStorage.getItem("palleon-user-templates")){var n=JSON.parse(localStorage.getItem("palleon-user-templates")),i=eT(n,a);0===i.length?localStorage.removeItem("palleon-user-templates"):localStorage.setItem("palleon-user-templates",JSON.stringify(i))}t.removeClass("favorited"),t.find(".material-icons").html("star_border"),toastr.success(palleonParams.unfavorited,palleonParams.success)}else{if(localStorage.getItem("palleon-user-templates")){var n=JSON.parse(localStorage.getItem("palleon-user-templates"));n.push(a),localStorage.setItem("palleon-user-templates",JSON.stringify(n))}else{var l=[];l[0]=a,localStorage.setItem("palleon-user-templates",JSON.stringify(l))}t.addClass("favorited"),t.find(".material-icons").html("star"),toastr.success(palleonParams.favorited,palleonParams.success)}e3()}),a.find("#custom-theme").on("change",function(){var t=e(this).val(),n=i.baseURL+"css/"+t+".css";e("#palleon-theme-link").attr("href",n),a.removeClass("light-theme"),a.removeClass("dark-theme"),a.addClass(t+"-theme")}),a.find("#custom-font-size").on("input",function(){e("html").css("font-size",e(this).val()+"px")}),a.find("#custom-background").on("change",function(){var t=e(this).val();""!=t&&a.find("#palleon-content").css("background-color",t)}),a.find("#custom-image-background").on("change",function(){var t=e(this).val();a.find("#palleon-canvas-color").spectrum("set",t),""==t?(v.backgroundColor="transparent",v.requestRenderAll()):(v.backgroundColor=t,v.requestRenderAll())}),a.find("#ruler-guide-color").on("change",function(){var t=e(this).val();""!=t&&(a.find(".guide.h, .guide.v").css("border-color",t),initAligningGuidelines(v))}),a.find("#ruler-guide-size").on("input",function(){var t=e(this).val();a.find(".guide.h, .guide.v").css("border-width",t+"px"),initAligningGuidelines(v)}),a.find("#palleon-preferences-save").on("click",function(){var t={},n=[],i=[];a.find("#palleon-preferences .preference").each(function(t,a){n.push(e(this).attr("id")),i.push(e(this).val())});for(let l=0;l<n.length;l++)t[n[l]]=i[l];localStorage.setItem("palleon-user-settings",JSON.stringify(t)),toastr.success(palleonParams.settingsaved,palleonParams.success)}),localStorage.getItem("palleon-user-settings")){var eR=JSON.parse(localStorage.getItem("palleon-user-settings"));a.find("#custom-font-size").val(eR["custom-font-size"]);var e1=a.find("#custom-font-size").parent().parent();e1.find(".slider-label span").html(eR["custom-font-size"]),a.find("#custom-font-size").trigger("input"),a.find("#custom-theme").val(eR["custom-theme"]),e("body").removeClass("dark-theme"),e("body").removeClass("light-theme"),e("body").addClass(eR["custom-theme"]+"-theme"),a.find("#custom-theme").trigger("change"),a.find("#custom-background").spectrum("set",eR["custom-background"]),a.find("#custom-background").trigger("change"),a.find("#ruler-guide-color").spectrum("set",eR["ruler-guide-color"]),a.find("#ruler-guide-color").trigger("change"),a.find("#ruler-guide-size").val(eR["ruler-guide-size"]);var e1=a.find("#ruler-guide-size").parent().parent();e1.find(".slider-label span").html(eR["ruler-guide-size"]),a.find("#ruler-guide-size").trigger("input")}initAligningGuidelines(v),e(window).on("resize",function(){ed()}),i.customFunctions.call(this,a,v,T)}}(jQuery);